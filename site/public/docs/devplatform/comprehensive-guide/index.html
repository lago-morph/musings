<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/musings/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=musings/livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This document provides a comprehensive overview of Kargo and ArgoCD, two complementary tools in the GitOps ecosystem. While ArgoCD excels at continuous deployment by syncing Kubernetes clusters to desired states stored in Git repositories, it lacks built-in promotion workflows between environments. Kargo fills this gap by orchestrating progressive rollouts across multiple stages (dev, staging, production) while maintaining GitOps principles.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/musings/docs/devplatform/comprehensive-guide/">
  <meta property="og:site_name" content="Technology Documentation Hub">
  <meta property="og:title" content="Driven vs Event: Comparison">
  <meta property="og:description" content="This document provides a comprehensive overview of Kargo and ArgoCD, two complementary tools in the GitOps ecosystem. While ArgoCD excels at continuous deployment by syncing Kubernetes clusters to desired states stored in Git repositories, it lacks built-in promotion workflows between environments. Kargo fills this gap by orchestrating progressive rollouts across multiple stages (dev, staging, production) while maintaining GitOps principles.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-12-16T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-16T00:00:00+00:00">


  <meta itemprop="name" content="Driven vs Event: Comparison">
  <meta itemprop="description" content="This document provides a comprehensive overview of Kargo and ArgoCD, two complementary tools in the GitOps ecosystem. While ArgoCD excels at continuous deployment by syncing Kubernetes clusters to desired states stored in Git repositories, it lacks built-in promotion workflows between environments. Kargo fills this gap by orchestrating progressive rollouts across multiple stages (dev, staging, production) while maintaining GitOps principles.">
  <meta itemprop="datePublished" content="2025-12-16T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-12-16T00:00:00+00:00">
  <meta itemprop="wordCount" content="5782">
  <meta itemprop="keywords" content="kargo,argocd,yaml,gitops,production,helm,api,kubernetes">

<title>Driven vs Event: Comparison | Technology Documentation Hub</title>
<link rel="icon" href="/musings/favicon.png" >
<link rel="manifest" href="/musings/manifest.json">
<link rel="canonical" href="http://localhost:1313/musings/docs/devplatform/comprehensive-guide/">
<link rel="stylesheet" href="/musings/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/musings/fuse.min.js"></script>
  <script defer src="/musings/en.search.min.5cc9128683126c7cda9fef74044c10c013f6d8935e1e3e719e3f562033e9ef44.js" integrity="sha256-XMkShoMSbHzan&#43;90BEwQwBP22JNeHj5xnj9WIDPp70Q=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/musings/"><span>Technology Documentation Hub</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/" class="">
      AI &amp; Machine Learning</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/agentic-computing-overview-and-tools/" class="">
      Agentic Computing Overview And Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/agno-vs-langchain/" class="">
      Agno Vs Langchain</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/flowwise-vs-langflow/" class="">
      Flowise vs Langflow: Detailed Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/one-model-multiple-diagrams/" class="">
      Generate all views</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/verification-architecture/" class="">
      Is This a Reasonable Architecture?</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/kiro-ide-comparison-tools/" class="">
      Kiro IDE: Comprehensive Analysis, Comparisons &amp; Optimal Workflows</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/langchain-architecture/" class="">
      LangChain: The Foundation Library</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/llm-tracing-metrics-comparison/" class="">
      Llm Tracing Metrics Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/kubernetes-based/" class="">
      Open Source Workflow Orchestration on Kubernetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/tools-overview-and-getting-started/" class="">
      Self-Hosted Open Source Agent Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/serverless-function-workflow-tools-for-kubernetes/" class="">
      Serverless/Function Workflows on Kubernetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/n8n-overview/" class="">
      What Problems Does n8n Solve?</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/" class="">
      Development Platforms</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/backstage-techdocs-pros-cons/" class="">
      Backstage Techdocs Pros Cons</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/cross-diagram-reuse-guide/" class="">
      Cross-Diagram Domain Model Reuse in PlantUML</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/prompt/" class="">
      Crossplane EKS Management Cluster Implementation - Project Brief</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/comprehensive-guide/" class="active">
      Driven vs Event: Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/gitops-platform-safety/" class="">
      GitOps Safety Architecture for Platform Evolution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-intro/" class="">
      How Kargo Works with ArgoCD to Manage Deployments</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/backstage-kratix-crossplane-argocd-blueprint/" class="">
      Implementation Blueprint: Crossplane &#43; Kratix &#43; Backstage &#43; ArgoCD</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-git-tags/" class="">
      In subsequent stages, you can read this metadata</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/in-browser-editing-tools/" class="">
      In-Browser Editing Documentation Solutions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/initial-comparison/" class="">
      Initial Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-argocd-interaction/" class="">
      Kargo promotion step</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/presentation/" class="">
      Kargo: GitOps Promotion for ArgoCD</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/notion-overview/" class="">
      Notion: A Comprehensive Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/oss-portal-platform-orchestration-tools/" class="">
      Oss Portal Platform Orchestration Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/oss-vs-closed-portal/" class="">
      Oss Vs Closed Portal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/recommendations/" class="">
      Overview of Text-Based UML Domain Modeling Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/export-conversion/" class="">
      PlantUML Export &amp; Embedding Options</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/crossplane-solution/" class="">
      Pseudocode for composition function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-polyrepo/" class="">
      Response</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/job-configmap-crossplane-abstraction/" class="">
      Shell script helper for Option 3</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/tasks/" class="">
      Stage 1: Approach Overview &amp; Comparison ✅ COMPLETE</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/stage3-outline/" class="">
      Stage 3: Implementation Patterns - Outline (Crossplane 2.1)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/" class="">
      Infrastructure</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/runbooks/" class="">
      1. Mental Model Shift (Important Framing)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/argocd-layered-values/" class="">
      ArgoCD and Helm Schema Validation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/prompt-guide/" class="">
      Contents</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/overview/" class="">
      Core Strategy: Progressive Delivery with Blast Radius Containment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/stage1/" class="">
      Crossplane EKS Management Cluster - Approach Overview &amp; Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/getting-started-concise/" class="">
      Getting Started Concise</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/ci-cd-templates/" class="">
      GitHub Actions Example</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/k8s-mcp-servers/" class="">
      K8s Mcp Servers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/stage2/" class="">
      Management Cluster VPC Layout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/non-helm-schema-validation/" class="">
      Non Helm Schema Validation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/production-readiness-overview/" class="">
      Production Readiness Guide: From Docker Compose to Kubernetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/schema-testing/" class="">
      Quick Start: Generate Schema from Existing values.yaml</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/job-plus-configmap-annotation/" class="">
      Read current state AND capture resourceVersion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/layered-schema/" class="">
      Schema Validation with Layered Values Files</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/helm-layered-abstraction/" class="">
      Solution 2: Kustomize with Helm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/starting-helm-testing/" class="">
      Understanding What You&#39;re Testing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/executive-summary/" class="">
      What You&#39;re Building</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/devops-domain-model-guide/" class="">
      Why This Approach Works for DevOps</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/workflows/" class="">
      Workflows</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/workflows/imperitive-in-declarative/" class="">
      Imperitive In Declarative</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/mermaid-test/" class="">
      Mermaid Diagram Test</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/misc/" class="">
      Miscellaneous</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/test-document/" class="">
      Test Document</a>
  

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/musings/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Driven vs Event: Comparison</h3>

  <label for="toc-control">
    
    <img src="/musings/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#kargo-and-argocd-a-comprehensive-guide">Kargo and ArgoCD: A Comprehensive Guide</a>
      <ul>
        <li><a href="#executive-summary">Executive Summary</a></li>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#argocd-continuous-deployment">ArgoCD: Continuous Deployment</a></li>
            <li><a href="#kargo-continuous-promotion">Kargo: Continuous Promotion</a></li>
          </ul>
        </li>
        <li><a href="#core-concepts">Core Concepts</a>
          <ul>
            <li><a href="#1-kargo-fundamental-concepts">1. Kargo Fundamental Concepts</a>
              <ul>
                <li><a href="#warehouses">Warehouses</a></li>
                <li><a href="#freight">Freight</a></li>
                <li><a href="#stages">Stages</a></li>
                <li><a href="#promotions">Promotions</a></li>
                <li><a href="#projects">Projects</a></li>
              </ul>
            </li>
            <li><a href="#2-how-kargo-and-argocd-work-together">2. How Kargo and ArgoCD Work Together</a>
              <ul>
                <li><a href="#the-integration-model">The Integration Model</a></li>
                <li><a href="#typical-promotion-workflow">Typical Promotion Workflow</a></li>
              </ul>
            </li>
            <li><a href="#3-multi-repository-artifact-management">3. Multi-Repository Artifact Management</a>
              <ul>
                <li><a href="#the-challenge">The Challenge</a></li>
                <li><a href="#kargos-solution-freight-bundles">Kargo&rsquo;s Solution: Freight Bundles</a></li>
                <li><a href="#comparison-to-traditional-unified-versioning">Comparison to Traditional Unified Versioning</a></li>
                <li><a href="#handling-incompatible-combinations">Handling Incompatible Combinations</a></li>
              </ul>
            </li>
            <li><a href="#4-combining-and-manipulating-freight">4. Combining and Manipulating Freight</a>
              <ul>
                <li><a href="#can-you-combine-freight-after-creation">Can You Combine Freight After Creation?</a></li>
              </ul>
            </li>
            <li><a href="#5-external-release-tracking">5. External Release Tracking</a>
              <ul>
                <li><a href="#the-challenge-1">The Challenge</a></li>
                <li><a href="#creating-tags-for-external-tracking">Creating Tags for External Tracking</a></li>
              </ul>
            </li>
            <li><a href="#6-promotion-templates-and-tasks">6. Promotion Templates and Tasks</a>
              <ul>
                <li><a href="#promotion-templates">Promotion Templates</a></li>
                <li><a href="#promotion-tasks">Promotion Tasks</a></li>
              </ul>
            </li>
            <li><a href="#7-warehouse-configuration-patterns">7. Warehouse Configuration Patterns</a>
              <ul>
                <li><a href="#subscription-types">Subscription Types</a></li>
                <li><a href="#selection-strategies">Selection Strategies</a></li>
                <li><a href="#freight-creation-policies">Freight Creation Policies</a></li>
              </ul>
            </li>
            <li><a href="#8-progressive-delivery-patterns">8. Progressive Delivery Patterns</a>
              <ul>
                <li><a href="#common-case-pattern">Common Case Pattern</a></li>
                <li><a href="#grouped-services-pattern">Grouped Services Pattern</a></li>
                <li><a href="#independent-pipelines-pattern">Independent Pipelines Pattern</a></li>
                <li><a href="#gatekeeper-stage-pattern">Gatekeeper Stage Pattern</a></li>
              </ul>
            </li>
            <li><a href="#9-verification-and-health-monitoring">9. Verification and Health Monitoring</a>
              <ul>
                <li><a href="#stage-health">Stage Health</a></li>
                <li><a href="#health-check-registration">Health Check Registration</a></li>
                <li><a href="#verification">Verification</a></li>
              </ul>
            </li>
            <li><a href="#10-storage-and-branch-strategies">10. Storage and Branch Strategies</a>
              <ul>
                <li><a href="#stage-specific-branches">Stage-Specific Branches</a></li>
                <li><a href="#single-branch-with-paths">Single Branch with Paths</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#architectural-principles">Architectural Principles</a>
          <ul>
            <li><a href="#gitops-compliance">GitOps Compliance</a></li>
            <li><a href="#separation-of-concerns">Separation of Concerns</a></li>
            <li><a href="#state-driven-vs-event-driven">State-Driven vs. Event-Driven</a></li>
            <li><a href="#multi-tenancy">Multi-Tenancy</a></li>
          </ul>
        </li>
        <li><a href="#best-practices">Best Practices</a>
          <ul>
            <li><a href="#1-repository-structure">1. Repository Structure</a></li>
            <li><a href="#2-freight-creation">2. Freight Creation</a></li>
            <li><a href="#3-promotion-workflows">3. Promotion Workflows</a></li>
            <li><a href="#4-health-and-verification">4. Health and Verification</a></li>
            <li><a href="#5-security-and-access-control">5. Security and Access Control</a></li>
            <li><a href="#6-external-tracking">6. External Tracking</a></li>
          </ul>
        </li>
        <li><a href="#common-pitfalls-and-solutions">Common Pitfalls and Solutions</a>
          <ul>
            <li><a href="#pitfall-1-freight-with-incompatible-versions">Pitfall 1: Freight with Incompatible Versions</a></li>
            <li><a href="#pitfall-2-feedback-loops">Pitfall 2: Feedback Loops</a></li>
            <li><a href="#pitfall-3-lost-freight-context">Pitfall 3: Lost Freight Context</a></li>
            <li><a href="#pitfall-4-slow-artifact-discovery">Pitfall 4: Slow Artifact Discovery</a></li>
            <li><a href="#pitfall-5-argocd-application-not-syncing">Pitfall 5: ArgoCD Application Not Syncing</a></li>
          </ul>
        </li>
        <li><a href="#appendices">Appendices</a>
          <ul>
            <li><a href="#appendix-a-complete-warehouse-examples">Appendix A: Complete Warehouse Examples</a>
              <ul>
                <li><a href="#a1-single-image-subscription">A.1 Single Image Subscription</a></li>
                <li><a href="#a2-multi-repository-subscription-with-criteria">A.2 Multi-Repository Subscription with Criteria</a></li>
                <li><a href="#a3-manual-freight-assembly-configuration">A.3 Manual Freight Assembly Configuration</a></li>
                <li><a href="#a4-git-repository-with-path-filters">A.4 Git Repository with Path Filters</a></li>
              </ul>
            </li>
            <li><a href="#appendix-b-stage-configuration-examples">Appendix B: Stage Configuration Examples</a>
              <ul>
                <li><a href="#b1-development-stage-with-auto-promotion">B.1 Development Stage with Auto-Promotion</a></li>
                <li><a href="#b2-production-stage-with-manual-approval">B.2 Production Stage with Manual Approval</a></li>
                <li><a href="#b3-stage-using-multiple-warehouses">B.3 Stage Using Multiple Warehouses</a></li>
              </ul>
            </li>
            <li><a href="#appendix-c-argocd-application-examples">Appendix C: ArgoCD Application Examples</a>
              <ul>
                <li><a href="#c1-basic-application-with-kargo-authorization">C.1 Basic Application with Kargo Authorization</a></li>
                <li><a href="#c2-applicationset-for-multiple-stages">C.2 ApplicationSet for Multiple Stages</a></li>
                <li><a href="#c3-multi-source-application">C.3 Multi-Source Application</a></li>
              </ul>
            </li>
            <li><a href="#appendix-d-promotion-task-examples">Appendix D: Promotion Task Examples</a>
              <ul>
                <li><a href="#d1-reusable-git-update-task">D.1 Reusable Git Update Task</a></li>
                <li><a href="#d2-using-promotion-task-in-stage">D.2 Using Promotion Task in Stage</a></li>
                <li><a href="#d3-pull-request-workflow-task">D.3 Pull Request Workflow Task</a></li>
              </ul>
            </li>
            <li><a href="#appendix-e-advanced-configuration-examples">Appendix E: Advanced Configuration Examples</a>
              <ul>
                <li><a href="#e1-freight-clone-for-hotfix">E.1 Freight Clone for Hotfix</a></li>
                <li><a href="#e2-release-tagging-with-complete-manifest">E.2 Release Tagging with Complete Manifest</a></li>
                <li><a href="#e3-notification-integration">E.3 Notification Integration</a></li>
              </ul>
            </li>
            <li><a href="#appendix-f-troubleshooting-guide">Appendix F: Troubleshooting Guide</a>
              <ul>
                <li><a href="#f1-freight-not-being-created">F.1 Freight Not Being Created</a></li>
                <li><a href="#f2-promotion-failing">F.2 Promotion Failing</a></li>
                <li><a href="#f3-argocd-application-not-syncing">F.3 ArgoCD Application Not Syncing</a></li>
                <li><a href="#f4-stage-health-reporting-degraded">F.4 Stage Health Reporting Degraded</a></li>
              </ul>
            </li>
            <li><a href="#appendix-g-expression-reference">Appendix G: Expression Reference</a>
              <ul>
                <li><a href="#g1-context-variables">G.1 Context Variables</a></li>
                <li><a href="#g2-artifact-functions">G.2 Artifact Functions</a></li>
                <li><a href="#g3-variable-references">G.3 Variable References</a></li>
                <li><a href="#g4-utility-functions">G.4 Utility Functions</a></li>
                <li><a href="#g5-freight-creation-criteria-examples">G.5 Freight Creation Criteria Examples</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#conclusion">Conclusion</a></li>
        <li><a href="#additional-resources">Additional Resources</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="kargo-and-argocd-a-comprehensive-guide">Kargo and ArgoCD: A Comprehensive Guide<a class="anchor" href="#kargo-and-argocd-a-comprehensive-guide">#</a></h1>
<h2 id="executive-summary">Executive Summary<a class="anchor" href="#executive-summary">#</a></h2>
<p>This document provides a comprehensive overview of Kargo and ArgoCD, two complementary tools in the GitOps ecosystem. While ArgoCD excels at continuous deployment by syncing Kubernetes clusters to desired states stored in Git repositories, it lacks built-in promotion workflows between environments. Kargo fills this gap by orchestrating progressive rollouts across multiple stages (dev, staging, production) while maintaining GitOps principles.</p>
<hr>
<h2 id="overview">Overview<a class="anchor" href="#overview">#</a></h2>
<h3 id="argocd-continuous-deployment">ArgoCD: Continuous Deployment<a class="anchor" href="#argocd-continuous-deployment">#</a></h3>
<p><strong>ArgoCD</strong> is a declarative, GitOps continuous delivery tool for Kubernetes. It continuously monitors Git repositories and ensures that the actual state of your Kubernetes cluster matches the desired state declared in Git.</p>
<p><strong>Core Capabilities:</strong></p>
<ul>
<li>Syncs Kubernetes clusters to Git repository states</li>
<li>Supports multiple configuration management tools (Kustomize, Helm, Jsonnet, plain YAML)</li>
<li>Provides automated deployment with rollback capabilities</li>
<li>Offers application health monitoring and visualization</li>
<li>Enables automated or manual sync policies</li>
</ul>
<p><strong>What ArgoCD Does Well:</strong></p>
<ul>
<li>Deploying applications to Kubernetes clusters</li>
<li>Maintaining desired state from Git</li>
<li>Detecting configuration drift</li>
<li>Providing deployment visualization</li>
</ul>
<p><strong>What ArgoCD Doesn&rsquo;t Provide:</strong></p>
<ul>
<li>No concept of &ldquo;promotion&rdquo; between environments</li>
<li>No orchestration of changes from dev → staging → production</li>
<li>No built-in artifact version tracking across stages</li>
<li>No progressive delivery workflows</li>
</ul>
<h3 id="kargo-continuous-promotion">Kargo: Continuous Promotion<a class="anchor" href="#kargo-continuous-promotion">#</a></h3>
<p><strong>Kargo</strong> is a continuous promotion platform that orchestrates the lifecycle of applications across multiple stages using GitOps principles. Built by the creators of Argo, Kargo automates progressive rollouts while integrating seamlessly with ArgoCD.</p>
<p><strong>Core Capabilities:</strong></p>
<ul>
<li>Multi-stage promotion orchestration (dev → staging → production)</li>
<li>Artifact tracking across environments (container images, Helm charts, Git commits)</li>
<li>State-driven promotion without relying on CI pipelines</li>
<li>Integration with ArgoCD for deployment execution</li>
<li>Audit trails and promotion history</li>
</ul>
<p><strong>The Complementary Relationship:</strong></p>
<ul>
<li><strong>ArgoCD</strong> = The deployment engine (handles the &ldquo;how&rdquo; of deploying)</li>
<li><strong>Kargo</strong> = The promotion orchestrator (handles the &ldquo;when&rdquo; and &ldquo;what&rdquo; gets promoted)</li>
</ul>
<hr>
<h2 id="core-concepts">Core Concepts<a class="anchor" href="#core-concepts">#</a></h2>
<h3 id="1-kargo-fundamental-concepts">1. Kargo Fundamental Concepts<a class="anchor" href="#1-kargo-fundamental-concepts">#</a></h3>
<h4 id="warehouses">Warehouses<a class="anchor" href="#warehouses">#</a></h4>
<p>Warehouses are the source of Freight. They monitor repositories (container registries, Git repositories, Helm chart repositories) for new artifact versions. When new artifacts are discovered, Warehouses produce Freight.</p>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li>Subscribe to one or more repositories</li>
<li>Discover new artifact versions automatically or on-demand</li>
<li>Apply version constraints (semver, lexical, newest)</li>
<li>Can be configured for automatic or manual Freight creation</li>
<li>Support webhook triggers for immediate discovery</li>
</ul>
<h4 id="freight">Freight<a class="anchor" href="#freight">#</a></h4>
<p>Freight represents a bundle of specific artifact versions that move through your promotion pipeline as a unit. Think of Freight as a &ldquo;meta-artifact&rdquo; or a shipping container that holds multiple artifacts together.</p>
<p><strong>What Freight Contains:</strong></p>
<ul>
<li>Specific container image versions (with digests, not just tags)</li>
<li>Specific Git commit SHAs</li>
<li>Specific Helm chart versions</li>
<li>Any combination of the above</li>
</ul>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li>Immutable once created (except alias and status fields)</li>
<li>Has a unique SHA-1 hash identifier</li>
<li>Has a human-friendly alias (e.g., &ldquo;brave-eagle&rdquo;)</li>
<li>References artifacts by immutable identifiers (image digests, commit SHAs)</li>
<li>Promoted as an atomic unit across stages</li>
</ul>
<p><strong>Critical Insight:</strong> Freight is NOT a single version number applied to everything. Instead, it&rsquo;s a tested, verified combination of specific artifact versions.</p>
<h4 id="stages">Stages<a class="anchor" href="#stages">#</a></h4>
<p>Stages represent promotion targets in your application lifecycle. While stages often correspond to environments (dev, staging, production), they technically represent any desired state that needs to be altered through promotion.</p>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li>Define what Freight they accept (from Warehouses or upstream Stages)</li>
<li>Specify how to promote Freight (promotion mechanisms)</li>
<li>Can be configured for automatic or manual promotion</li>
<li>Track health status of deployed applications</li>
<li>Form pipelines by subscribing to upstream Stages</li>
</ul>
<h4 id="promotions">Promotions<a class="anchor" href="#promotions">#</a></h4>
<p>Promotions are the execution of moving Freight into a Stage. A Promotion is a Kubernetes resource created when Freight is promoted to a Stage.</p>
<p><strong>What Happens During Promotion:</strong></p>
<ol>
<li>Execute a series of discrete steps (git clone, update manifests, commit, push)</li>
<li>Update GitOps repository with new artifact versions</li>
<li>Trigger ArgoCD Application sync</li>
<li>Monitor deployment health</li>
<li>Mark Stage as verified upon success</li>
</ol>
<p><strong>Promotion Mechanisms:</strong></p>
<ul>
<li>Git repository updates (modify Kustomize overlays, Helm values)</li>
<li>ArgoCD Application updates (trigger syncs, update revisions)</li>
<li>Custom scripts and workflows</li>
<li>Pull request workflows</li>
</ul>
<h4 id="projects">Projects<a class="anchor" href="#projects">#</a></h4>
<p>Projects are units of tenancy for organizing and managing promotion pipelines. Every Kargo Project is associated with a Kubernetes namespace, making it easy to manage access using standard Kubernetes RBAC.</p>
<h3 id="2-how-kargo-and-argocd-work-together">2. How Kargo and ArgoCD Work Together<a class="anchor" href="#2-how-kargo-and-argocd-work-together">#</a></h3>
<h4 id="the-integration-model">The Integration Model<a class="anchor" href="#the-integration-model">#</a></h4>
<p>Kargo and ArgoCD integrate through a <strong>declarative, Kubernetes-native approach</strong>. Kargo does NOT call ArgoCD&rsquo;s REST API; instead, it modifies ArgoCD Application Custom Resources directly via the Kubernetes API.</p>
<p><strong>Primary Interaction Methods:</strong></p>
<ol>
<li><strong>Custom Resource Modification:</strong> Kargo patches ArgoCD Application resources to update fields like <code>targetRevision</code> or trigger sync operations</li>
<li><strong>Status Monitoring:</strong> Kargo continuously watches Application health and sync status</li>
<li><strong>Authorization via Annotations:</strong> Applications explicitly authorize Stages to manage them</li>
</ol>
<p><strong>Authorization Model:</strong></p>
<p>Applications must be annotated to grant Kargo permission:</p>
<pre tabindex="0"><code>kargo.akuity.io/authorized-stage: &#34;&lt;project-name&gt;:&lt;stage-name&gt;&#34;</code></pre><p>This annotation-based delegation ensures that only authorized Stages can modify specific Applications. Since the annotation can only be added by someone authorized to update the Application, Kargo interprets it as explicit permission.</p>
<h4 id="typical-promotion-workflow">Typical Promotion Workflow<a class="anchor" href="#typical-promotion-workflow">#</a></h4>
<ol>
<li><strong>Artifact Discovery:</strong> Warehouse detects new container image in registry</li>
<li><strong>Freight Creation:</strong> Warehouse creates Freight referencing the new image version</li>
<li><strong>Git Update:</strong> Developer approves promotion; Kargo updates GitOps repository</li>
<li><strong>Application Patch:</strong> Kargo patches ArgoCD Application&rsquo;s targetRevision field</li>
<li><strong>ArgoCD Sync:</strong> ArgoCD detects change and syncs cluster to new state</li>
<li><strong>Health Monitoring:</strong> Kargo monitors Application health</li>
<li><strong>Stage Verification:</strong> Once healthy, Freight is marked as verified for next Stage</li>
<li><strong>Progressive Promotion:</strong> Verified Freight can be promoted to subsequent Stages</li>
</ol>
<p><strong>Key Insight:</strong> ArgoCD focuses on deployment mechanics (syncing Git to cluster), while Kargo handles promotion logic (orchestrating what gets deployed when).</p>
<h3 id="3-multi-repository-artifact-management">3. Multi-Repository Artifact Management<a class="anchor" href="#3-multi-repository-artifact-management">#</a></h3>
<h4 id="the-challenge">The Challenge<a class="anchor" href="#the-challenge">#</a></h4>
<p>In modern microservices architectures, applications often have:</p>
<ul>
<li>Application code in multiple repositories</li>
<li>Dockerfiles in a separate repository</li>
<li>Helm charts in another repository</li>
<li>Configuration spread across multiple locations</li>
</ul>
<p>How does Kargo keep all these in sync?</p>
<h4 id="kargos-solution-freight-bundles">Kargo&rsquo;s Solution: Freight Bundles<a class="anchor" href="#kargos-solution-freight-bundles">#</a></h4>
<p>Kargo creates Freight bundles that reference specific versions of ALL artifacts from multiple repositories. A single Warehouse can subscribe to multiple repositories, and when it discovers new versions, it produces Freight containing one version of each artifact.</p>
<p><strong>Example Freight Bundle:</strong></p>
<ul>
<li>Frontend image: <code>myapp/frontend:v2.1.0</code> (digest: sha256:abc&hellip;)</li>
<li>Backend image: <code>myapp/backend:v3.0.1</code> (digest: sha256:def&hellip;)</li>
<li>Helm chart: <code>my-chart:v0.5.2</code></li>
<li>Config commit: <code>7f4e8c2a9b1d3e5f6a8c9d0e1f2a3b4c5d6e7f8a</code></li>
</ul>
<p>Being referenced by a single Freight resource, these artifacts are promoted from stage to stage together as a unit.</p>
<h4 id="comparison-to-traditional-unified-versioning">Comparison to Traditional Unified Versioning<a class="anchor" href="#comparison-to-traditional-unified-versioning">#</a></h4>
<p><strong>Traditional Approach (Unified Version Tags):</strong></p>
<ul>
<li>Tag everything with the same version (e.g., v1.5.0)</li>
<li>Simple mental model and easy communication</li>
<li>BUT: Tight coupling, requires rebuilding everything for any change</li>
<li>BUT: Can&rsquo;t promote just a config change or single service update</li>
</ul>
<p><strong>Kargo Approach (Freight Bundles):</strong></p>
<ul>
<li>Each artifact maintains its own version</li>
<li>Bundled together as tested combinations</li>
<li>Independent versioning with coordinated promotion</li>
<li>Selective promotion capabilities</li>
</ul>
<p><strong>Key Trade-offs:</strong></p>
<ul>
<li>Unified versioning: Simple but inflexible</li>
<li>Kargo bundles: Flexible but more complex</li>
</ul>
<h4 id="handling-incompatible-combinations">Handling Incompatible Combinations<a class="anchor" href="#handling-incompatible-combinations">#</a></h4>
<p><strong>The Race Condition Problem:</strong></p>
<p>When Warehouses subscribe to multiple repositories, there&rsquo;s a risk of creating incompatible Freight:</p>
<ol>
<li>CI pushes <code>frontend:v2.0.0</code></li>
<li>Kargo discovers it immediately</li>
<li>Kargo creates Freight with <code>frontend:v2.0.0</code> + <code>backend:v1.5.0</code> (old)</li>
<li>This combination is incompatible</li>
<li>Later <code>backend:v2.0.0</code> arrives, but Freight already exists</li>
</ol>
<p><strong>Solutions:</strong></p>
<ol>
<li><strong>Freight Creation Criteria:</strong> Use expressions to ensure only compatible combinations create Freight</li>
<li><strong>Multiple Warehouses:</strong> Separate fast-moving artifacts (images) from slow-moving ones (config)</li>
<li><strong>Manual Freight Assembly:</strong> Disable automatic creation and manually select compatible versions</li>
<li><strong>Gatekeeper Stage:</strong> Create initial stage where failures are acceptable, filtering bad combinations</li>
</ol>
<h3 id="4-combining-and-manipulating-freight">4. Combining and Manipulating Freight<a class="anchor" href="#4-combining-and-manipulating-freight">#</a></h3>
<h4 id="can-you-combine-freight-after-creation">Can You Combine Freight After Creation?<a class="anchor" href="#can-you-combine-freight-after-creation">#</a></h4>
<p><strong>Short Answer:</strong> No direct merging, but several approaches achieve similar outcomes.</p>
<p><strong>Why No Direct Merging:</strong></p>
<ul>
<li>Freight is immutable by design (for audit trails and reproducibility)</li>
<li>Merging would break the clean Warehouse → Freight → Stage lineage</li>
<li>Could create untested combinations that bypass verification</li>
</ul>
<p><strong>Available Approaches:</strong></p>
<ol>
<li>
<p><strong>Manual Freight Assembly:</strong> Configure Warehouse to discover multiple versions but not auto-create Freight; manually select which versions to bundle</p>
</li>
<li>
<p><strong>Freight Cloning:</strong> Use existing Freight as a template, replacing only specific artifacts (useful for hotfixes)</p>
</li>
<li>
<p><strong>Multiple Warehouses with Stage-Level Combination:</strong> Different Warehouses track different artifact types; Stages request Freight from multiple Warehouses and combine during promotion</p>
</li>
<li>
<p><strong>Freight Creation Criteria:</strong> Define expressions that control when automatic Freight creation occurs</p>
</li>
</ol>
<p><strong>Use Cases:</strong></p>
<ul>
<li><strong>Hotfixes:</strong> Clone production Freight, replace one buggy component</li>
<li><strong>Testing:</strong> Create &ldquo;what-if&rdquo; combinations without new builds</li>
<li><strong>Different Cadences:</strong> Promote images frequently, config changes rarely</li>
</ul>
<h3 id="5-external-release-tracking">5. External Release Tracking<a class="anchor" href="#5-external-release-tracking">#</a></h3>
<h4 id="the-challenge-1">The Challenge<a class="anchor" href="#the-challenge-1">#</a></h4>
<p>While Kargo provides excellent internal tracking through Freight objects and Git commits, organizations often need to track releases in external systems or create unified version numbers for communication purposes.</p>
<h4 id="creating-tags-for-external-tracking">Creating Tags for External Tracking<a class="anchor" href="#creating-tags-for-external-tracking">#</a></h4>
<p>Kargo doesn&rsquo;t automatically create Git tags for component combinations, but you can implement custom tagging in promotion workflows.</p>
<p><strong>Approaches:</strong></p>
<ol>
<li>
<p><strong>Git Tags in Promotion Process:</strong> Use bash steps to create annotated tags containing all component versions</p>
</li>
<li>
<p><strong>Release Manifest Files:</strong> Create versioned YAML/JSON files in Git documenting exact component versions for each release</p>
</li>
<li>
<p><strong>Freight Metadata:</strong> Attach metadata to Freight resources using the set-metadata promotion step</p>
</li>
<li>
<p><strong>External System Integration:</strong> Send release information to external tracking systems via HTTP calls or notifications</p>
</li>
</ol>
<p><strong>Benefits of Hybrid Approach:</strong></p>
<ul>
<li>Kargo tracks components internally (Freight + commits)</li>
<li>Git tags provide external visibility</li>
<li>Release manifests enable programmatic access</li>
<li>External systems can query Git without Kargo access</li>
</ul>
<p><strong>Trade-offs:</strong></p>
<ul>
<li>Internal tracking (Freight): Rich, immutable, tied to promotion workflow</li>
<li>External tags: Simple, universally accessible, but requires custom implementation</li>
</ul>
<h3 id="6-promotion-templates-and-tasks">6. Promotion Templates and Tasks<a class="anchor" href="#6-promotion-templates-and-tasks">#</a></h3>
<h4 id="promotion-templates">Promotion Templates<a class="anchor" href="#promotion-templates">#</a></h4>
<p>Promotion Templates define how Kargo transitions Freight into a Stage by executing a series of discrete, composable steps. Each Stage has a promotion template that specifies exactly what actions to take when Freight is promoted.</p>
<p><strong>Common Promotion Steps:</strong></p>
<ul>
<li><strong>git-clone:</strong> Clone Git repository and checkout specific commits/branches</li>
<li><strong>git-clear:</strong> Clear working directory contents</li>
<li><strong>yaml-update:</strong> Update YAML file values (image tags, versions)</li>
<li><strong>kustomize-set-image:</strong> Update Kustomize image references</li>
<li><strong>helm-update-image:</strong> Update Helm values files</li>
<li><strong>git-commit:</strong> Commit all changes to working tree</li>
<li><strong>git-push:</strong> Push commits to remote repository</li>
<li><strong>argocd-update:</strong> Update ArgoCD Applications and trigger syncs</li>
</ul>
<h4 id="promotion-tasks">Promotion Tasks<a class="anchor" href="#promotion-tasks">#</a></h4>
<p>Promotion Tasks are reusable sets of promotion steps that can be shared across multiple Stages or Projects. They come in two forms:</p>
<ul>
<li><strong>PromotionTask:</strong> Project-scoped, available within a single Project</li>
<li><strong>ClusterPromotionTask:</strong> Cluster-scoped, available across all Projects</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>Standardize common workflows</li>
<li>Reduce duplication</li>
<li>Centralize best practices</li>
<li>Enable organizational patterns</li>
</ul>
<h3 id="7-warehouse-configuration-patterns">7. Warehouse Configuration Patterns<a class="anchor" href="#7-warehouse-configuration-patterns">#</a></h3>
<h4 id="subscription-types">Subscription Types<a class="anchor" href="#subscription-types">#</a></h4>
<p>Warehouses can subscribe to:</p>
<ul>
<li><strong>Container Image Repositories:</strong> Monitor for new image tags</li>
<li><strong>Git Repositories:</strong> Monitor for new commits or tags</li>
<li><strong>Helm Chart Repositories:</strong> Monitor for new chart versions</li>
</ul>
<h4 id="selection-strategies">Selection Strategies<a class="anchor" href="#selection-strategies">#</a></h4>
<p>Different strategies for selecting which artifacts to track:</p>
<p><strong>For Git Repositories:</strong></p>
<ul>
<li><strong>NewestFromBranch:</strong> Latest commit from specified branch</li>
<li><strong>SemVer:</strong> Commit referenced by tag matching semantic versioning constraint</li>
<li><strong>Lexical:</strong> Latest tag by lexical ordering</li>
</ul>
<p><strong>For Container Images:</strong></p>
<ul>
<li><strong>SemVer:</strong> Images with semantic version tags</li>
<li><strong>Lexical:</strong> Latest by lexical tag ordering</li>
<li><strong>NewestBuild:</strong> Most recently built image</li>
</ul>
<h4 id="freight-creation-policies">Freight Creation Policies<a class="anchor" href="#freight-creation-policies">#</a></h4>
<p><strong>Automatic:</strong> Warehouse creates Freight whenever new artifacts are discovered (default)</p>
<p><strong>Manual:</strong> Warehouse discovers artifacts but doesn&rsquo;t create Freight; user manually selects versions</p>
<p><strong>Automatic with Criteria:</strong> Warehouse creates Freight only when expression evaluates to true (prevents incompatible combinations)</p>
<h3 id="8-progressive-delivery-patterns">8. Progressive Delivery Patterns<a class="anchor" href="#8-progressive-delivery-patterns">#</a></h3>
<h4 id="common-case-pattern">Common Case Pattern<a class="anchor" href="#common-case-pattern">#</a></h4>
<p>Single Warehouse subscribes to both image repository and Git repository. Each discovery produces Freight with both an image version and config commit. Artifacts promoted together as a unit through all stages.</p>
<p><strong>Use Case:</strong> Most standard applications where image and config should stay coordinated.</p>
<h4 id="grouped-services-pattern">Grouped Services Pattern<a class="anchor" href="#grouped-services-pattern">#</a></h4>
<p>Single Warehouse subscribes to multiple service image repositories. All services promoted together as a tightly-coupled unit.</p>
<p><strong>Use Case:</strong> Microservices that have strong interdependencies and must be deployed together.</p>
<h4 id="independent-pipelines-pattern">Independent Pipelines Pattern<a class="anchor" href="#independent-pipelines-pattern">#</a></h4>
<p>Multiple Warehouses track different artifact types. Each produces Freight independently, creating parallel promotion pipelines through the same Stages.</p>
<p><strong>Use Case:</strong> Promote images rapidly (multiple times daily) while promoting config changes slowly and deliberately.</p>
<h4 id="gatekeeper-stage-pattern">Gatekeeper Stage Pattern<a class="anchor" href="#gatekeeper-stage-pattern">#</a></h4>
<p>Initial Stage allows failures to filter out bad Freight combinations before they reach important environments.</p>
<p><strong>Use Case:</strong> Prevent incompatible artifact combinations from progressing through pipeline.</p>
<h3 id="9-verification-and-health-monitoring">9. Verification and Health Monitoring<a class="anchor" href="#9-verification-and-health-monitoring">#</a></h3>
<h4 id="stage-health">Stage Health<a class="anchor" href="#stage-health">#</a></h4>
<p>Stage health is determined by multiple factors:</p>
<ul>
<li>Health of ArgoCD Applications managed by the Stage</li>
<li>Verification checks configured on the Stage</li>
<li>Promotion completion status</li>
<li>Custom health indicators</li>
</ul>
<p><strong>Key Insight:</strong> Stage health is NOT just Application health. It encompasses all health checks registered during promotion, including custom verification.</p>
<h4 id="health-check-registration">Health Check Registration<a class="anchor" href="#health-check-registration">#</a></h4>
<p>When the argocd-update step completes successfully, it registers health checks that continuously monitor the Application. This enables Kargo to factor ArgoCD Application health into Stage health without requiring Kargo to understand Application health directly.</p>
<h4 id="verification">Verification<a class="anchor" href="#verification">#</a></h4>
<p>Stages can define verification processes that must pass before Freight is considered verified:</p>
<ul>
<li>Argo Rollouts AnalysisRun resources</li>
<li>Kubernetes Jobs for custom tests</li>
<li>External validation systems</li>
</ul>
<h3 id="10-storage-and-branch-strategies">10. Storage and Branch Strategies<a class="anchor" href="#10-storage-and-branch-strategies">#</a></h3>
<h4 id="stage-specific-branches">Stage-Specific Branches<a class="anchor" href="#stage-specific-branches">#</a></h4>
<p>Kargo commonly uses stage-specific branches in GitOps repositories:</p>
<ul>
<li><code>stage/dev</code> contains rendered manifests for dev environment</li>
<li><code>stage/staging</code> contains rendered manifests for staging</li>
<li><code>stage/production</code> contains rendered manifests for production</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>Clear separation of environment states</li>
<li>Easy rollback (checkout previous commit on branch)</li>
<li>Complete history per environment</li>
<li>No merge conflicts between environments</li>
</ul>
<p><strong>Important:</strong> These are NOT Git Flow branches requiring merging. Each branch is independent storage for rendered state.</p>
<h4 id="single-branch-with-paths">Single Branch with Paths<a class="anchor" href="#single-branch-with-paths">#</a></h4>
<p>Alternative approach uses single branch (main/trunk) with different paths:</p>
<ul>
<li><code>builds/dev/</code> contains dev manifests</li>
<li><code>builds/staging/</code> contains staging manifests</li>
<li><code>builds/production/</code> contains production manifests</li>
</ul>
<p><strong>Key Requirement:</strong> Warehouse must use path filters to avoid triggering new Freight from its own promotion outputs (creating feedback loops).</p>
<hr>
<h2 id="architectural-principles">Architectural Principles<a class="anchor" href="#architectural-principles">#</a></h2>
<h3 id="gitops-compliance">GitOps Compliance<a class="anchor" href="#gitops-compliance">#</a></h3>
<p>Both Kargo and ArgoCD adhere to GitOps principles:</p>
<ul>
<li><strong>Declarative:</strong> Desired state defined declaratively</li>
<li><strong>Versioned:</strong> All state stored in Git with full history</li>
<li><strong>Immutable:</strong> Freight and commits are immutable</li>
<li><strong>Automated:</strong> Changes automatically reconciled</li>
<li><strong>Auditable:</strong> Complete trail of who changed what when</li>
</ul>
<h3 id="separation-of-concerns">Separation of Concerns<a class="anchor" href="#separation-of-concerns">#</a></h3>
<p><strong>ArgoCD Responsibilities:</strong></p>
<ul>
<li>Monitor Git repositories for changes</li>
<li>Sync Kubernetes clusters to Git state</li>
<li>Detect and remediate drift</li>
<li>Report application health</li>
</ul>
<p><strong>Kargo Responsibilities:</strong></p>
<ul>
<li>Track artifact versions across repositories</li>
<li>Create Freight bundles of compatible versions</li>
<li>Orchestrate promotion workflows</li>
<li>Update Git repositories with new versions</li>
<li>Coordinate ArgoCD syncs</li>
</ul>
<p><strong>Neither Tool Requires the Other:</strong></p>
<ul>
<li>ArgoCD works without Kargo (manual promotions)</li>
<li>Kargo can work with other CD tools (though optimized for ArgoCD)</li>
</ul>
<h3 id="state-driven-vs-event-driven">State-Driven vs. Event-Driven<a class="anchor" href="#state-driven-vs-event-driven">#</a></h3>
<p><strong>Traditional CI/CD:</strong> Event-driven (push events trigger deployments)</p>
<p><strong>Kargo + ArgoCD:</strong> State-driven (pull-based, continuous reconciliation)</p>
<p><strong>Benefits:</strong></p>
<ul>
<li>More reliable (no lost events)</li>
<li>Self-healing (automatically recovers from failures)</li>
<li>Auditable (current state always in Git)</li>
<li>Predictable (deterministic outcomes)</li>
</ul>
<h3 id="multi-tenancy">Multi-Tenancy<a class="anchor" href="#multi-tenancy">#</a></h3>
<p><strong>Kargo Projects:</strong></p>
<ul>
<li>Map to Kubernetes namespaces</li>
<li>Isolated with Kubernetes RBAC</li>
<li>Can delegate authority via annotations</li>
<li>Support for multiple projects per cluster</li>
</ul>
<p><strong>ArgoCD Applications:</strong></p>
<ul>
<li>Can be namespaced for isolation</li>
<li>Controlled by ArgoCD RBAC</li>
<li>Kargo respects ArgoCD boundaries</li>
</ul>
<hr>
<h2 id="best-practices">Best Practices<a class="anchor" href="#best-practices">#</a></h2>
<h3 id="1-repository-structure">1. Repository Structure<a class="anchor" href="#1-repository-structure">#</a></h3>
<p><strong>Recommended Approach:</strong></p>
<ul>
<li>Separate source code repositories from GitOps repositories</li>
<li>Use GitOps repository exclusively for deployment manifests</li>
<li>Structure GitOps repo with base configuration and environment-specific overlays</li>
<li>Use Kustomize or Helm for configuration management</li>
</ul>
<h3 id="2-freight-creation">2. Freight Creation<a class="anchor" href="#2-freight-creation">#</a></h3>
<p><strong>Guidelines:</strong></p>
<ul>
<li>Use automatic Freight creation with criteria for coordinated releases</li>
<li>Use manual Freight assembly when compatibility is complex</li>
<li>Implement gatekeeper Stages for filtering bad combinations</li>
<li>Leverage Freight aliases for human-friendly identification</li>
</ul>
<h3 id="3-promotion-workflows">3. Promotion Workflows<a class="anchor" href="#3-promotion-workflows">#</a></h3>
<p><strong>Recommendations:</strong></p>
<ul>
<li>Start with automatic promotions to dev/test</li>
<li>Require manual approval for production</li>
<li>Implement verification checks before allowing promotion</li>
<li>Use stage-specific branches for clear separation</li>
<li>Document promotion process in Promotion Tasks</li>
</ul>
<h3 id="4-health-and-verification">4. Health and Verification<a class="anchor" href="#4-health-and-verification">#</a></h3>
<p><strong>Best Practices:</strong></p>
<ul>
<li>Configure appropriate health checks on ArgoCD Applications</li>
<li>Implement automated verification where possible</li>
<li>Use Argo Rollouts for progressive delivery patterns</li>
<li>Monitor Stage health continuously</li>
<li>Set realistic timeout values for verifications</li>
</ul>
<h3 id="5-security-and-access-control">5. Security and Access Control<a class="anchor" href="#5-security-and-access-control">#</a></h3>
<p><strong>Guidelines:</strong></p>
<ul>
<li>Use Kubernetes RBAC for access control</li>
<li>Leverage annotation-based authorization for delegation</li>
<li>Restrict who can approve production promotions</li>
<li>Audit promotion history regularly</li>
<li>Use sealed secrets or external secret management</li>
</ul>
<h3 id="6-external-tracking">6. External Tracking<a class="anchor" href="#6-external-tracking">#</a></h3>
<p><strong>Recommendations:</strong></p>
<ul>
<li>Implement Git tags for major releases to production</li>
<li>Create release manifest files for programmatic access</li>
<li>Use Freight metadata for runtime tracking</li>
<li>Send notifications to external systems for visibility</li>
<li>Maintain both internal (Freight) and external (tags) tracking</li>
</ul>
<hr>
<h2 id="common-pitfalls-and-solutions">Common Pitfalls and Solutions<a class="anchor" href="#common-pitfalls-and-solutions">#</a></h2>
<h3 id="pitfall-1-freight-with-incompatible-versions">Pitfall 1: Freight with Incompatible Versions<a class="anchor" href="#pitfall-1-freight-with-incompatible-versions">#</a></h3>
<p><strong>Problem:</strong> Warehouse creates Freight with frontend:v2.0 + backend:v1.5 that are incompatible</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>Use Freight creation criteria expressions</li>
<li>Implement gatekeeper Stage</li>
<li>Use manual Freight assembly</li>
<li>Tag components with matching versions</li>
</ul>
<h3 id="pitfall-2-feedback-loops">Pitfall 2: Feedback Loops<a class="anchor" href="#pitfall-2-feedback-loops">#</a></h3>
<p><strong>Problem:</strong> Warehouse triggers on its own promotion outputs, creating infinite loop</p>
<p><strong>Solution:</strong> Use path filters (includePaths/excludePaths) to ignore promotion output directories</p>
<h3 id="pitfall-3-lost-freight-context">Pitfall 3: Lost Freight Context<a class="anchor" href="#pitfall-3-lost-freight-context">#</a></h3>
<p><strong>Problem:</strong> Can&rsquo;t determine which versions are in production outside Kargo</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>Create Git tags during production promotions</li>
<li>Generate release manifest files</li>
<li>Send notifications to external tracking systems</li>
<li>Use Freight metadata</li>
</ul>
<h3 id="pitfall-4-slow-artifact-discovery">Pitfall 4: Slow Artifact Discovery<a class="anchor" href="#pitfall-4-slow-artifact-discovery">#</a></h3>
<p><strong>Problem:</strong> Warehouses take too long to discover new artifacts</p>
<p><strong>Solutions:</strong></p>
<ul>
<li>Configure webhooks for immediate discovery</li>
<li>Adjust polling intervals</li>
<li>Optimize image selection strategies</li>
<li>Use discovery limits to reduce processing</li>
</ul>
<h3 id="pitfall-5-argocd-application-not-syncing">Pitfall 5: ArgoCD Application Not Syncing<a class="anchor" href="#pitfall-5-argocd-application-not-syncing">#</a></h3>
<p><strong>Problem:</strong> ArgoCD doesn&rsquo;t sync after Kargo promotion</p>
<p><strong>Common Causes:</strong></p>
<ul>
<li>Missing authorization annotation</li>
<li>Incorrect targetRevision format</li>
<li>ArgoCD sync policy prevents auto-sync</li>
<li>Application health checks failing</li>
</ul>
<p><strong>Solutions:</strong></p>
<ul>
<li>Verify authorization annotation</li>
<li>Check ArgoCD Application logs</li>
<li>Ensure sync policy allows syncs</li>
<li>Review Application health status</li>
</ul>
<hr>
<h2 id="appendices">Appendices<a class="anchor" href="#appendices">#</a></h2>
<h3 id="appendix-a-complete-warehouse-examples">Appendix A: Complete Warehouse Examples<a class="anchor" href="#appendix-a-complete-warehouse-examples">#</a></h3>
<h4 id="a1-single-image-subscription">A.1 Single Image Subscription<a class="anchor" href="#a1-single-image-subscription">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-warehouse</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">subscriptions</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">public.ecr.aws/nginx/nginx</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">semverConstraint</span>: <span style="color:#ae81ff">^1.26.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">discoveryLimit</span>: <span style="color:#ae81ff">5</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Monitors nginx image repository</li>
<li>Only considers versions matching ^1.26.0 (1.26.x)</li>
<li>Keeps last 5 discovered versions available</li>
<li>Creates Freight automatically when new versions discovered</li>
</ul>
<h4 id="a2-multi-repository-subscription-with-criteria">A.2 Multi-Repository Subscription with Criteria<a class="anchor" href="#a2-multi-repository-subscription-with-criteria">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">coordinated-release</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">freightCreationPolicy</span>: <span style="color:#ae81ff">Automatic</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">freightCreationCriteria</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">expression</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      imageFrom(&#39;myapp/frontend&#39;).Tag == 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      imageFrom(&#39;myapp/backend&#39;).Tag &amp;&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      imageFrom(&#39;myapp/backend&#39;).Tag == 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      chartFrom(&#39;my-chart&#39;).Version</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">subscriptions</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">myapp/frontend</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">semverConstraint</span>: <span style="color:#ae81ff">^2.0.0</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">myapp/backend</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">semverConstraint</span>: <span style="color:#ae81ff">^2.0.0</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">chart</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://charts.example.com</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-chart</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">semverConstraint</span>: <span style="color:#ae81ff">^2.0.0</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Subscribes to two images and one Helm chart</li>
<li>Only creates Freight when all three have matching version tags</li>
<li>Prevents incompatible combinations</li>
<li>Requires coordinated release versioning</li>
</ul>
<h4 id="a3-manual-freight-assembly-configuration">A.3 Manual Freight Assembly Configuration<a class="anchor" href="#a3-manual-freight-assembly-configuration">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">manual-assembly</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">freightCreationPolicy</span>: <span style="color:#ae81ff">Manual</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">subscriptions</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">myapp/frontend</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">discoveryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">image</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">myapp/backend</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">discoveryLimit</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">git</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/config.git</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">commitSelectionStrategy</span>: <span style="color:#ae81ff">SemVer</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Discovers artifacts but doesn&rsquo;t auto-create Freight</li>
<li>Keeps 10 versions of each image available</li>
<li>User manually selects compatible combination via UI/CLI</li>
<li>Ideal when compatibility rules are complex</li>
</ul>
<h4 id="a4-git-repository-with-path-filters">A.4 Git Repository with Path Filters<a class="anchor" href="#a4-git-repository-with-path-filters">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">monorepo-app</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">subscriptions</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">git</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/monorepo.git</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">commitSelectionStrategy</span>: <span style="color:#ae81ff">NewestFromBranch</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">includePaths</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">apps/my-service</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">excludePaths</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">apps/my-service/README.md</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">apps/my-service/docs</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Monitors only specific paths in monorepo</li>
<li>Creates Freight only when changes affect my-service</li>
<li>Excludes documentation changes</li>
<li>Prevents unnecessary Freight creation</li>
</ul>
<h3 id="appendix-b-stage-configuration-examples">Appendix B: Stage Configuration Examples<a class="anchor" href="#appendix-b-stage-configuration-examples">#</a></h3>
<h4 id="b1-development-stage-with-auto-promotion">B.1 Development Stage with Auto-Promotion<a class="anchor" href="#b1-development-stage-with-auto-promotion">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Stage</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Subscribe to Warehouse</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">requestedFreight</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">origin</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-warehouse</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">direct</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Auto-promote new Freight</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">promotionTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitopsRepo</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">imageRepo</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">myapp/service</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Clone GitOps repository</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clone</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">checkout</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">stage/dev</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Clear output directory</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clear</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update image in Kustomize</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">kustomize-set-image</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">as</span>: <span style="color:#ae81ff">update-image</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src/overlays/dev</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">images</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">${{ vars.imageRepo }}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">${{ imageFrom(vars.imageRepo).Tag }}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Build Kustomize manifests</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">kustomize-build</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src/overlays/dev</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">outPath</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Commit changes</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-commit</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">as</span>: <span style="color:#ae81ff">commit</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">message</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Updated dev to ${{ imageFrom(vars.imageRepo).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Image: ${{ vars.imageRepo }}:${{ imageFrom(vars.imageRepo).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Digest: ${{ imageFrom(vars.imageRepo).Digest }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Freight: ${{ ctx.freight.name }}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Push to stage branch</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-push</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update ArgoCD Application</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">argocd-update</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">apps</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-dev</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">desiredRevision</span>: <span style="color:#ae81ff">${{ outputs.commit.commit }}</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Automatically promotes new Freight from Warehouse</li>
<li>Clones GitOps repo to two paths (source and output)</li>
<li>Updates image tag in Kustomize overlay</li>
<li>Builds manifests and commits to stage/dev branch</li>
<li>Triggers ArgoCD sync to new commit</li>
</ul>
<h4 id="b2-production-stage-with-manual-approval">B.2 Production Stage with Manual Approval<a class="anchor" href="#b2-production-stage-with-manual-approval">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Stage</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Subscribe to upstream staging Stage</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">requestedFreight</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">origin</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-warehouse</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">stages</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">staging</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Require manual promotion (no auto-promotion)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">promotionTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitopsRepo</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">releaseTag</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">release-${{ timestamp(&#34;2006.01.02-150405&#34;) }}</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Standard promotion steps</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clone</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">checkout</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">stage/production</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clear</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">kustomize-set-image</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src/overlays/production</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">images</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">myapp/frontend</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">myapp/backend</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">${{ imageFrom(&#39;myapp/backend&#39;).Tag }}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">kustomize-build</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src/overlays/production</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">outPath</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-commit</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">as</span>: <span style="color:#ae81ff">commit</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">message</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Production Release ${{ vars.releaseTag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Freight: ${{ ctx.freight.alias }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Frontend: ${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Backend: ${{ imageFrom(&#39;myapp/backend&#39;).Tag }}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-push</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Create release tag</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">bash</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              #!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              cd ./out
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git tag -a &#34;${{ vars.releaseTag }}&#34; -m &#34;Production Release
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Freight: ${{ ctx.freight.name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Promoted: $(date -u +%Y-%m-%dT%H:%M:%SZ)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Components:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              - Frontend: ${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              - Backend: ${{ imageFrom(&#39;myapp/backend&#39;).Tag }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git push origin &#34;${{ vars.releaseTag }}&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">argocd-update</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">apps</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-production</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Only promotes Freight verified in staging</li>
<li>Requires manual trigger (no auto-promotion)</li>
<li>Updates multiple images</li>
<li>Creates Git tag for release tracking</li>
<li>Provides external visibility via tags</li>
</ul>
<h4 id="b3-stage-using-multiple-warehouses">B.3 Stage Using Multiple Warehouses<a class="anchor" href="#b3-stage-using-multiple-warehouses">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Stage</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">staging</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Request Freight from two different Warehouses</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">requestedFreight</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">origin</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">app-images</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">direct</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">origin</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">infrastructure-config</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">direct</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">promotionTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitopsRepo</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clone</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">checkout</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#75715e"># Checkout from both Warehouses&#39; subscribed repos</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">commit</span>: <span style="color:#ae81ff">${{ commitFrom(&#39;github.com/myorg/helm-charts&#39;).ID }}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./charts</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">stage/staging</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clear</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update with images from first Warehouse</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">helm-update-image</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./charts/values.yaml</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">images</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">myapp/frontend</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">frontend.image.tag</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">value</span>: <span style="color:#ae81ff">${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}</span>
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">myapp/backend</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">key</span>: <span style="color:#ae81ff">backend.image.tag</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">value</span>: <span style="color:#ae81ff">${{ imageFrom(&#39;myapp/backend&#39;).Tag }}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Template Helm chart</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">helm-template</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./charts</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">outPath</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">releaseName</span>: <span style="color:#ae81ff">myapp-staging</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-commit</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">message</span>: <span style="color:#e6db74">&#34;Updated staging&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-push</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">argocd-update</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">apps</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-staging</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Combines Freight from two Warehouses</li>
<li>One Warehouse tracks images (fast-moving)</li>
<li>Other Warehouse tracks infrastructure config (slow-moving)</li>
<li>Allows independent promotion cadences</li>
</ul>
<h3 id="appendix-c-argocd-application-examples">Appendix C: ArgoCD Application Examples<a class="anchor" href="#appendix-c-argocd-application-examples">#</a></h3>
<h4 id="c1-basic-application-with-kargo-authorization">C.1 Basic Application with Kargo Authorization<a class="anchor" href="#c1-basic-application-with-kargo-authorization">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Application</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Authorize Kargo Stage to manage this Application</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kargo.akuity.io/authorized-stage</span>: <span style="color:#ae81ff">my-project:dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">source</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetRevision</span>: <span style="color:#ae81ff">stage/dev</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">path</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">destination</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">https://kubernetes.default.svc</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">myapp-dev</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automated</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">selfHeal</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">syncOptions</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">CreateNamespace=true</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Annotation grants dev Stage permission to update Application</li>
<li>Points to stage/dev branch (updated by Kargo)</li>
<li>Auto-sync enabled so ArgoCD syncs automatically</li>
<li>Creates namespace if it doesn&rsquo;t exist</li>
</ul>
<h4 id="c2-applicationset-for-multiple-stages">C.2 ApplicationSet for Multiple Stages<a class="anchor" href="#c2-applicationset-for-multiple-stages">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ApplicationSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-all-stages</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">generators</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">list</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">elements</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">staging</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">stage</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-{{stage}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Dynamic authorization per stage</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kargo.akuity.io/authorized-stage</span>: <span style="color:#ae81ff">my-project:{{stage}}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">project</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">source</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">targetRevision</span>: <span style="color:#ae81ff">stage/{{stage}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">.</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">destination</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">server</span>: <span style="color:#ae81ff">https://kubernetes.default.svc</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">myapp-{{stage}}</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">syncOptions</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">CreateNamespace=true</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Creates three Applications (dev, staging, production)</li>
<li>Each authorized to its corresponding Kargo Stage</li>
<li>Each points to its own stage-specific branch</li>
<li>Reduces duplication in Application definitions</li>
</ul>
<h4 id="c3-multi-source-application">C.3 Multi-Source Application<a class="anchor" href="#c3-multi-source-application">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Application</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-production</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">argocd</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kargo.akuity.io/authorized-stage</span>: <span style="color:#ae81ff">my-project:production</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">project</span>: <span style="color:#ae81ff">default</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Helm chart from chart repository</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://charts.example.com</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">chart</span>: <span style="color:#ae81ff">myapp</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetRevision</span>: <span style="color:#ae81ff">2.1.0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">helm</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">valueFiles</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">$values/overlays/production/values.yaml</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Values from Git repository</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">targetRevision</span>: <span style="color:#ae81ff">stage/production</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ref</span>: <span style="color:#ae81ff">values</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">destination</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">server</span>: <span style="color:#ae81ff">https://kubernetes.default.svc</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">myapp-production</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automated</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">selfHeal</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Uses Helm chart from chart repository</li>
<li>Overlays values from GitOps repository</li>
<li>Kargo updates targetRevision of values source</li>
<li>Allows separating chart version from configuration</li>
</ul>
<h3 id="appendix-d-promotion-task-examples">Appendix D: Promotion Task Examples<a class="anchor" href="#appendix-d-promotion-task-examples">#</a></h3>
<h4 id="d1-reusable-git-update-task">D.1 Reusable Git Update Task<a class="anchor" href="#d1-reusable-git-update-task">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PromotionTask</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">standard-git-update</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitopsRepo</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Required variable, must be provided when task is used</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stagePath</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Required variable for path to stage overlay</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">imageRepo</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Required variable for image repository</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clone</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">checkout</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src</span>
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">stage/${{ ctx.stage }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">create</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clear</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">kustomize-set-image</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">as</span>: <span style="color:#ae81ff">update-image</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src/${{ vars.stagePath }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">images</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">${{ vars.imageRepo }}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">tag</span>: <span style="color:#ae81ff">${{ imageFrom(vars.imageRepo).Tag }}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">kustomize-build</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./src/${{ vars.stagePath }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">outPath</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-commit</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">as</span>: <span style="color:#ae81ff">commit</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">messageFromSteps</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#ae81ff">update-image</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-push</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./out</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">compose-output</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">as</span>: <span style="color:#ae81ff">output</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">commit</span>: <span style="color:#ae81ff">${{ task.outputs.commit.commit }}</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Defines reusable promotion workflow</li>
<li>Accepts variables for customization</li>
<li>Outputs commit SHA for use in Stage</li>
<li>Can be referenced by multiple Stages</li>
</ul>
<h4 id="d2-using-promotion-task-in-stage">D.2 Using Promotion Task in Stage<a class="anchor" href="#d2-using-promotion-task-in-stage">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Stage</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">requestedFreight</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">origin</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Warehouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-warehouse</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">direct</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">promotionTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Reference the PromotionTask</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">task</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">standard-git-update</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitopsRepo</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">value</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">stagePath</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">value</span>: <span style="color:#ae81ff">overlays/dev</span>
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">imageRepo</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">value</span>: <span style="color:#ae81ff">myapp/service</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use output from task</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">argocd-update</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">apps</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-dev</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">sources</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">desiredRevision</span>: <span style="color:#ae81ff">${{ outputs[&#39;standard-git-update&#39;].commit }}</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>References PromotionTask by name</li>
<li>Provides required variables</li>
<li>Accesses task outputs in subsequent steps</li>
<li>Enables code reuse across Stages</li>
</ul>
<h4 id="d3-pull-request-workflow-task">D.3 Pull Request Workflow Task<a class="anchor" href="#d3-pull-request-workflow-task">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterPromotionTask</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pr-workflow</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gitopsRepo</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">prTitle</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">default</span>: <span style="color:#e6db74">&#34;Kargo Promotion&#34;</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">prBody</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">default</span>: <span style="color:#e6db74">&#34;Automated promotion from Kargo&#34;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Standard git operations</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-clone</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">checkout</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./repo</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Make changes to manifests</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ... (update steps omitted for brevity)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-commit</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./repo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">message</span>: <span style="color:#ae81ff">${{ vars.prTitle }}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Push to feature branch</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-push</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">as</span>: <span style="color:#ae81ff">push</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./repo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">generateTargetBranch</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Open pull request</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-open-pr</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">as</span>: <span style="color:#ae81ff">open-pr</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">sourceBranch</span>: <span style="color:#ae81ff">${{ outputs.push.branch }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">targetBranch</span>: <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">title</span>: <span style="color:#ae81ff">${{ vars.prTitle }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">description</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          ${{ vars.prBody }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Freight: ${{ ctx.freight.alias }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          Stage: ${{ ctx.stage }}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Wait for PR to be merged</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-wait-for-pr</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">prNumber</span>: <span style="color:#ae81ff">${{ outputs[&#39;open-pr&#39;].pr.id }}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Merge PR automatically (optional)</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">git-merge-pr</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">prNumber</span>: <span style="color:#ae81ff">${{ outputs[&#39;open-pr&#39;].pr.id }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">wait</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">compose-output</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">as</span>: <span style="color:#ae81ff">output</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">prNumber</span>: <span style="color:#ae81ff">${{ outputs[&#39;open-pr&#39;].pr.id }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">merged</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div><p><strong>Explanation:</strong></p>
<ul>
<li>Opens pull request instead of direct push</li>
<li>Waits for PR approval/checks</li>
<li>Optionally auto-merges after checks pass</li>
<li>Provides audit trail through PR system</li>
<li>Cluster-scoped so available to all Projects</li>
</ul>
<h3 id="appendix-e-advanced-configuration-examples">Appendix E: Advanced Configuration Examples<a class="anchor" href="#appendix-e-advanced-configuration-examples">#</a></h3>
<h4 id="e1-freight-clone-for-hotfix">E.1 Freight Clone for Hotfix<a class="anchor" href="#e1-freight-clone-for-hotfix">#</a></h4>
<p>Using Freight cloning capability to create hotfix Freight:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Production has Freight with these artifacts:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - frontend:v2.0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - backend:v2.0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - database:v1.5.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Hotfix scenario: Critical bug in backend:v2.0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Build and push backend:v2.0.1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Clone production Freight via UI/CLI:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. Select production Freight</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. Click &#34;Clone Freight&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. Select backend artifact</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4. Change version to v2.0.1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 5. Create new Freight</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Result: New Freight with:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - frontend:v2.0.0 (unchanged)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - backend:v2.0.1 (hotfix)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - database:v1.5.0 (unchanged)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Promote hotfix Freight directly to production</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># (bypassing dev/staging for emergency)</span></span></span></code></pre></div><p><strong>Use Case:</strong></p>
<ul>
<li>Critical production bug requiring immediate fix</li>
<li>Don&rsquo;t want to wait for full pipeline</li>
<li>Keep all other components at production versions</li>
<li>Skip lower environments for urgency</li>
</ul>
<h4 id="e2-release-tagging-with-complete-manifest">E.2 Release Tagging with Complete Manifest<a class="anchor" href="#e2-release-tagging-with-complete-manifest">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Stage</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">promotionTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">vars</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">releaseVersion</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">v${{ timestamp(&#34;2006.01.02&#34;) }}-${{ ctx.freight.alias }}</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ... standard promotion steps ...</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Create comprehensive release tag</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">bash</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              #!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              cd ./out
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              # Create annotated tag with full component manifest
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git tag -a &#34;${{ vars.releaseVersion }}&#34; -m &#34;Production Release ${{ vars.releaseVersion }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Kargo Freight: ${{ ctx.freight.name }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Freight Alias: ${{ ctx.freight.alias }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Promoted At: $(date -u +%Y-%m-%dT%H:%M:%SZ)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Promoted By: ${{ ctx.promotion.createdBy }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Component Manifest:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              ==================
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Frontend:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Image: myapp/frontend:${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Digest: ${{ imageFrom(&#39;myapp/frontend&#39;).Digest }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Backend:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Image: myapp/backend:${{ imageFrom(&#39;myapp/backend&#39;).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Digest: ${{ imageFrom(&#39;myapp/backend&#39;).Digest }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Database Migrations:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Image: myapp/migrations:${{ imageFrom(&#39;myapp/migrations&#39;).Tag }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Digest: ${{ imageFrom(&#39;myapp/migrations&#39;).Digest }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Helm Chart:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Name: myapp
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Version: ${{ chartFrom(&#39;myapp&#39;).Version }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Configuration:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Repository: github.com/myorg/config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Commit: ${{ commitFrom(&#39;github.com/myorg/config&#39;).ID }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                Commit Message: ${{ commitFrom(&#39;github.com/myorg/config&#39;).Message }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              &#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git push origin &#34;${{ vars.releaseVersion }}&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Create machine-readable release manifest</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">bash</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              #!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              mkdir -p ./out/releases
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              cat &gt; ./out/releases/${{ vars.releaseVersion }}.json &lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;version&#34;: &#34;${{ vars.releaseVersion }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;freight&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;name&#34;: &#34;${{ ctx.freight.name }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;alias&#34;: &#34;${{ ctx.freight.alias }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;stage&#34;: &#34;${{ ctx.stage }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;timestamp&#34;: &#34;$(date -u +%Y-%m-%dT%H:%M:%SZ)&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;promotedBy&#34;: &#34;${{ ctx.promotion.createdBy }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                &#34;components&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;frontend&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;image&#34;: &#34;myapp/frontend&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;tag&#34;: &#34;${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;digest&#34;: &#34;${{ imageFrom(&#39;myapp/frontend&#39;).Digest }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;backend&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;image&#34;: &#34;myapp/backend&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;tag&#34;: &#34;${{ imageFrom(&#39;myapp/backend&#39;).Tag }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;digest&#34;: &#34;${{ imageFrom(&#39;myapp/backend&#39;).Digest }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;migrations&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;image&#34;: &#34;myapp/migrations&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;tag&#34;: &#34;${{ imageFrom(&#39;myapp/migrations&#39;).Tag }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;digest&#34;: &#34;${{ imageFrom(&#39;myapp/migrations&#39;).Digest }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;chart&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;name&#34;: &#34;myapp&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;version&#34;: &#34;${{ chartFrom(&#39;myapp&#39;).Version }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;config&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;repository&#34;: &#34;github.com/myorg/config&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;commit&#34;: &#34;${{ commitFrom(&#39;github.com/myorg/config&#39;).ID }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;message&#34;: &#34;${{ commitFrom(&#39;github.com/myorg/config&#39;).Message }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git add releases/${{ vars.releaseVersion }}.json
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git commit -m &#34;Add release manifest for ${{ vars.releaseVersion }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              git push</span></span></span></code></pre></div><p><strong>Benefits:</strong></p>
<ul>
<li>Git tag provides human-readable release notes</li>
<li>JSON manifest enables programmatic access</li>
<li>External tools can query releases without Kargo</li>
<li>Complete audit trail of what was deployed</li>
<li>Immutable record in Git history</li>
</ul>
<h4 id="e3-notification-integration">E.3 Notification Integration<a class="anchor" href="#e3-notification-integration">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kargo.akuity.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Stage</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">promotionTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ... standard promotion steps ...</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send Slack notification</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">send-message</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">destination</span>: <span style="color:#ae81ff">slack</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">channel</span>: <span style="color:#e6db74">&#34;#releases&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">message</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              🚀 **Production Release Deployed**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              **Release:** ${{ vars.releaseVersion }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              **Freight:** ${{ ctx.freight.alias }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              **Promoted By:** ${{ ctx.promotion.createdBy }}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              **Components:**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              • Frontend: `${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              • Backend: `${{ imageFrom(&#39;myapp/backend&#39;).Tag }}`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              • Chart: `${{ chartFrom(&#39;myapp&#39;).Version }}`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              **Links:**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              • [ArgoCD App](https://argocd.example.com/applications/myapp-production)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              • [Git Tag](https://github.com/myorg/gitops/releases/tag/${{ vars.releaseVersion }})</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Send to external tracking system</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">bash</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              #!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              curl -X POST https://release-tracker.example.com/api/releases \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                -H &#34;Content-Type: application/json&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                -H &#34;Authorization: Bearer ${RELEASE_TRACKER_TOKEN}&#34; \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                -d &#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;version&#34;: &#34;${{ vars.releaseVersion }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;environment&#34;: &#34;production&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;freight&#34;: &#34;${{ ctx.freight.name }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;timestamp&#34;: &#34;&#39;$(date -u +%Y-%m-%dT%H:%M:%SZ)&#39;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  &#34;components&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;frontend&#34;: &#34;${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                    &#34;backend&#34;: &#34;${{ imageFrom(&#39;myapp/backend&#39;).Tag }}&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                  }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">                }&#39;</span></span></span></code></pre></div><p><strong>Use Cases:</strong></p>
<ul>
<li>Team awareness via Slack/Teams</li>
<li>Integration with release management tools</li>
<li>Triggering downstream automation</li>
<li>Compliance reporting</li>
</ul>
<h3 id="appendix-f-troubleshooting-guide">Appendix F: Troubleshooting Guide<a class="anchor" href="#appendix-f-troubleshooting-guide">#</a></h3>
<h4 id="f1-freight-not-being-created">F.1 Freight Not Being Created<a class="anchor" href="#f1-freight-not-being-created">#</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Warehouse shows no Freight</li>
<li>New artifact versions not detected</li>
</ul>
<p><strong>Diagnostic Steps:</strong></p>
<ol>
<li>Check Warehouse status:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get warehouse -n my-project my-warehouse -o yaml</span></span></code></pre></div><ol start="2">
<li>Look for errors in status:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">conditions</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Ready</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">status</span>: <span style="color:#e6db74">&#34;False&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">reason</span>: <span style="color:#ae81ff">DiscoveryFailed</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">message</span>: <span style="color:#e6db74">&#34;Failed to list images: unauthorized&#34;</span></span></span></code></pre></div><p><strong>Common Causes:</strong></p>
<p><strong>Missing Credentials:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Create secret for private registry</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">registry-creds</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kargo.akuity.io/cred-type</span>: <span style="color:#ae81ff">image</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">stringData</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">ghcr.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#ae81ff">myuser</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">ghp_xxxxxxxxxxxxx</span></span></span></code></pre></div><p><strong>Incorrect semver Constraint:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Wrong: No versions match constraint</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">semverConstraint</span>: <span style="color:#ae81ff">^3.0.0 </span> <span style="color:#75715e"># But only v2.x.x versions exist</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fix: Adjust constraint to match actual versions</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">semverConstraint</span>: <span style="color:#ae81ff">^2.0.0</span></span></span></code></pre></div><p><strong>Freight Creation Criteria Not Met:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Check if expression prevents creation</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">freightCreationCriteria</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">expression</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    imageFrom(&#39;frontend&#39;).Tag == imageFrom(&#39;backend&#39;).Tag</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># If tags don&#39;t match, no Freight created</span></span></span></code></pre></div><h4 id="f2-promotion-failing">F.2 Promotion Failing<a class="anchor" href="#f2-promotion-failing">#</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Promotion stuck in Running state</li>
<li>Promotion shows Failed status</li>
</ul>
<p><strong>Diagnostic Steps:</strong></p>
<ol>
<li>Get Promotion details:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get promotion -n my-project &lt;promotion-name&gt; -o yaml</span></span></code></pre></div><ol start="2">
<li>Check promotion status for errors:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">phase</span>: <span style="color:#ae81ff">Failed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">error</span>: <span style="color:#e6db74">&#34;git-push step failed: authentication required&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">stepResults</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">git-clone</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">status</span>: <span style="color:#ae81ff">Succeeded</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">git-commit</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">status</span>: <span style="color:#ae81ff">Succeeded</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">git-push</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">status</span>: <span style="color:#ae81ff">Failed</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">error</span>: <span style="color:#e6db74">&#34;remote: Permission denied&#34;</span></span></span></code></pre></div><p><strong>Common Causes:</strong></p>
<p><strong>Missing Git Credentials:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Create Git credentials secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Secret</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">git-creds</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">my-project</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kargo.akuity.io/cred-type</span>: <span style="color:#ae81ff">git</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">stringData</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">repoURL</span>: <span style="color:#ae81ff">https://github.com/myorg/gitops.git</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">username</span>: <span style="color:#ae81ff">myuser</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">ghp_xxxxxxxxxxxxx </span> <span style="color:#75715e"># GitHub PAT</span></span></span></code></pre></div><p><strong>ArgoCD Application Not Authorized:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Application missing annotation</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">argoproj.io/v1alpha1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Application</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-dev</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ADD THIS:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">kargo.akuity.io/authorized-stage</span>: <span style="color:#ae81ff">my-project:dev</span></span></span></code></pre></div><p><strong>Incorrect Expression Syntax:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Wrong:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value</span>: <span style="color:#ae81ff">${{ imageFrom(vars.imageRepo).Tag }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Right:</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">value</span>: <span style="color:#ae81ff">${{ imageFrom(vars.imageRepo).Tag }}</span></span></span></code></pre></div><h4 id="f3-argocd-application-not-syncing">F.3 ArgoCD Application Not Syncing<a class="anchor" href="#f3-argocd-application-not-syncing">#</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Promotion succeeds but Application stays OutOfSync</li>
<li>Application shows old revision</li>
</ul>
<p><strong>Diagnostic Steps:</strong></p>
<ol>
<li>Check Application status:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get application -n argocd myapp-dev -o yaml</span></span></code></pre></div><ol start="2">
<li>Check sync status:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">sync</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">status</span>: <span style="color:#ae81ff">OutOfSync</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">revision</span>: <span style="color:#ae81ff">old-commit-sha</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">operationState</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">phase</span>: <span style="color:#ae81ff">Failed</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">message</span>: <span style="color:#e6db74">&#34;ComparisonError: failed to get app details&#34;</span></span></span></code></pre></div><p><strong>Common Causes:</strong></p>
<p><strong>Sync Policy Prevents Auto-Sync:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Application configured for manual sync</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>: {}  <span style="color:#75715e"># No automated sync!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fix: Enable auto-sync</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">syncPolicy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">automated</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">prune</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">selfHeal</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div><p><strong>Target Revision Mismatch:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Kargo pushed to stage/dev branch</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># But Application points elsewhere</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">source</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetRevision</span>: <span style="color:#ae81ff">main </span> <span style="color:#75715e"># Should be stage/dev!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Kargo argocd-update should set this correctly</span></span></span></code></pre></div><p><strong>ArgoCD Can&rsquo;t Access Repository:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Check ArgoCD repository connection</span>
</span></span><span style="display:flex;"><span>kubectl get secret -n argocd | grep repo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Add repository to ArgoCD if missing</span>
</span></span><span style="display:flex;"><span>argocd repo add https://github.com/myorg/gitops.git <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --username myuser <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --password ghp_xxxxxxxxxxxxx</span></span></code></pre></div><h4 id="f4-stage-health-reporting-degraded">F.4 Stage Health Reporting Degraded<a class="anchor" href="#f4-stage-health-reporting-degraded">#</a></h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Stage shows Unhealthy status</li>
<li>Promotion succeeded but Stage not healthy</li>
</ul>
<p><strong>Diagnostic Steps:</strong></p>
<ol>
<li>Check Stage status:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get stage -n my-project dev -o yaml</span></span></code></pre></div><ol start="2">
<li>Review health status:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">status</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">health</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">status</span>: <span style="color:#ae81ff">Unhealthy</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">issues</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;Application myapp-dev is Degraded&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">currentFreight</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">abc123</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verificationHistory</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">phase</span>: <span style="color:#ae81ff">Failed</span></span></span></code></pre></div><p><strong>Common Causes:</strong></p>
<p><strong>Application Truly Unhealthy:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Check ArgoCD Application</span>
</span></span><span style="display:flex;"><span>kubectl get application -n argocd myapp-dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check pods in application namespace</span>
</span></span><span style="display:flex;"><span>kubectl get pods -n myapp-dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Common: ImagePullBackOff, CrashLoopBackOff</span></span></span></code></pre></div><p><strong>Verification Failing:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Check verification configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">verification</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">analysisTemplates</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">smoke-tests</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># If analysis fails, Stage becomes unhealthy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check AnalysisRun status</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kubectl get analysisrun -n my-project</span></span></span></code></pre></div><p><strong>Health Check Timeout:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Increase timeout in promotion step</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">argocd-update</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">config</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">apps</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">myapp-dev</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">timeout</span>: <span style="color:#ae81ff">10m </span> <span style="color:#75715e"># Default might be too short</span></span></span></code></pre></div><h3 id="appendix-g-expression-reference">Appendix G: Expression Reference<a class="anchor" href="#appendix-g-expression-reference">#</a></h3>
<p>Kargo uses expressions extensively in promotion templates. Here&rsquo;s a quick reference:</p>
<h4 id="g1-context-variables">G.1 Context Variables<a class="anchor" href="#g1-context-variables">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Current Stage name</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ ctx.stage }} </span> <span style="color:#75715e"># &#34;dev&#34;, &#34;production&#34;, etc.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Current Freight</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ ctx.freight.name }}  </span> <span style="color:#75715e"># SHA-1 hash identifier</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ ctx.freight.alias }} </span> <span style="color:#75715e"># Human-friendly alias</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Current Promotion</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ ctx.promotion.name }}      </span> <span style="color:#75715e"># Promotion resource name</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ ctx.promotion.createdBy }} </span> <span style="color:#75715e"># Who triggered promotion</span></span></span></code></pre></div><h4 id="g2-artifact-functions">G.2 Artifact Functions<a class="anchor" href="#g2-artifact-functions">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Image from Freight</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ imageFrom(&#39;myapp/frontend&#39;).Tag }}    </span> <span style="color:#75715e"># &#34;v2.1.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ imageFrom(&#39;myapp/frontend&#39;).Digest }} </span> <span style="color:#75715e"># &#34;sha256:abc...&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Git commit from Freight</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ commitFrom(&#39;github.com/myorg/repo&#39;).ID }}      </span> <span style="color:#75715e"># Commit SHA</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ commitFrom(&#39;github.com/myorg/repo&#39;).Message }} </span> <span style="color:#75715e"># Commit message</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Helm chart from Freight</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ chartFrom(&#39;my-chart&#39;).Version }} </span> <span style="color:#75715e"># &#34;1.2.3&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># With Warehouse filter</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ imageFrom(&#39;myapp/frontend&#39;, warehouse(&#39;my-warehouse&#39;)).Tag }}</span></span></span></code></pre></div><h4 id="g3-variable-references">G.3 Variable References<a class="anchor" href="#g3-variable-references">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Global variables</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ vars.gitopsRepo }}</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ vars.imageRepo }}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Step outputs</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ outputs.commit.commit }}          </span> <span style="color:#75715e"># From step with alias &#34;commit&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ outputs[&#39;update-image&#39;].message }}</span> <span style="color:#75715e"># Square bracket notation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Task outputs (in PromotionTask)</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ task.outputs[&#39;step-name&#39;].value }}</span></span></span></code></pre></div><h4 id="g4-utility-functions">G.4 Utility Functions<a class="anchor" href="#g4-utility-functions">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Timestamp</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ timestamp() }}                   </span> <span style="color:#75715e"># Unix timestamp</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ timestamp(&#34;2006.01.02&#34;) }}       </span> <span style="color:#75715e"># Formatted: 2025.01.15</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ timestamp(&#34;2006-01-02T15:04:05&#34;) }} </span> <span style="color:#75715e"># ISO format</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Quote for YAML safety</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">${{ quote(imageFrom(&#39;myapp/frontend&#39;).Tag) }}</span></span></span></code></pre></div><h4 id="g5-freight-creation-criteria-examples">G.5 Freight Creation Criteria Examples<a class="anchor" href="#g5-freight-creation-criteria-examples">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># Tags must match</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">imageFrom(&#39;frontend&#39;).Tag == imageFrom(&#39;backend&#39;).Tag</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Version greater than</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">imageFrom(&#39;myapp&#39;).Tag &gt; &#39;2.0.0&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Commit after date</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">commitFrom(&#39;github.com/myorg/repo&#39;).CommitterDate.After(date(&#39;2024-01-01&#39;))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Multiple conditions</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">imageFrom(&#39;frontend&#39;).Tag == imageFrom(&#39;backend&#39;).Tag &amp;&amp;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">imageFrom(&#39;backend&#39;).Tag == chartFrom(&#39;my-chart&#39;).Version</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tag doesn&#39;t contain alpha/beta</span>
</span></span><span style="display:flex;"><span>!<span style="color:#ae81ff">(imageFrom(&#39;myapp&#39;).Tag contains &#39;alpha&#39;) &amp;&amp;</span>
</span></span><span style="display:flex;"><span>!<span style="color:#ae81ff">(imageFrom(&#39;myapp&#39;).Tag contains &#39;beta&#39;)</span></span></span></code></pre></div><hr>
<h2 id="conclusion">Conclusion<a class="anchor" href="#conclusion">#</a></h2>
<p>Kargo and ArgoCD together provide a complete GitOps solution for modern Kubernetes deployments. ArgoCD handles the continuous deployment of applications to clusters, while Kargo orchestrates the progressive promotion of changes through multiple stages. By maintaining strict GitOps principles, providing comprehensive audit trails, and enabling flexible promotion workflows, these tools empower teams to deploy confidently and reliably at scale.</p>
<p>The key to success is understanding the separation of concerns: ArgoCD syncs clusters to Git state, while Kargo orchestrates what gets promoted when. Together, they eliminate manual deployment processes, reduce errors, and provide complete visibility into your application lifecycle.</p>
<hr>
<h2 id="additional-resources">Additional Resources<a class="anchor" href="#additional-resources">#</a></h2>
<p><strong>Kargo Documentation:</strong></p>
<ul>
<li>Official Docs: <a href="https://docs.kargo.io">https://docs.kargo.io</a></li>
<li>GitHub Repository: <a href="https://github.com/akuity/kargo">https://github.com/akuity/kargo</a></li>
<li>Quickstart Guide: <a href="https://docs.kargo.io/quickstart">https://docs.kargo.io/quickstart</a></li>
</ul>
<p><strong>ArgoCD Documentation:</strong></p>
<ul>
<li>Official Docs: <a href="https://argo-cd.readthedocs.io">https://argo-cd.readthedocs.io</a></li>
<li>GitHub Repository: <a href="https://github.com/argoproj/argo-cd">https://github.com/argoproj/argo-cd</a></li>
<li>Getting Started: <a href="https://argo-cd.readthedocs.io/en/stable/getting_started">https://argo-cd.readthedocs.io/en/stable/getting_started</a></li>
</ul>
<p><strong>Community:</strong></p>
<ul>
<li>Kargo Discord: <a href="https://discord.gg/kargo">https://discord.gg/kargo</a></li>
<li>CNCF Slack #argo-cd channel</li>
<li>Argo Project Community: <a href="https://argoproj.github.io/community/">https://argoproj.github.io/community/</a></li>
</ul>
<p><strong>Related Tools:</strong></p>
<ul>
<li>Argo Rollouts: Progressive delivery strategies</li>
<li>Argo Workflows: Workflow orchestration</li>
<li>Argo Events: Event-driven automation</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/musings/docs/devplatform/prompt/" class="flex align-center">
        <img src="/musings/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>Crossplane EKS Management Cluster Implementation - Project Brief</span>
      </a>
    
    </span>
    <span>
    
      <a href="/musings/docs/devplatform/gitops-platform-safety/" class="flex align-center">
        <span>GitOps Safety Architecture for Platform Evolution</span>
        <img src="/musings/icons/forward.svg" class="book-icon" alt="Forward" />
      </a>
    
    </span>
  </div>
  


 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#kargo-and-argocd-a-comprehensive-guide">Kargo and ArgoCD: A Comprehensive Guide</a>
      <ul>
        <li><a href="#executive-summary">Executive Summary</a></li>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#argocd-continuous-deployment">ArgoCD: Continuous Deployment</a></li>
            <li><a href="#kargo-continuous-promotion">Kargo: Continuous Promotion</a></li>
          </ul>
        </li>
        <li><a href="#core-concepts">Core Concepts</a>
          <ul>
            <li><a href="#1-kargo-fundamental-concepts">1. Kargo Fundamental Concepts</a>
              <ul>
                <li><a href="#warehouses">Warehouses</a></li>
                <li><a href="#freight">Freight</a></li>
                <li><a href="#stages">Stages</a></li>
                <li><a href="#promotions">Promotions</a></li>
                <li><a href="#projects">Projects</a></li>
              </ul>
            </li>
            <li><a href="#2-how-kargo-and-argocd-work-together">2. How Kargo and ArgoCD Work Together</a>
              <ul>
                <li><a href="#the-integration-model">The Integration Model</a></li>
                <li><a href="#typical-promotion-workflow">Typical Promotion Workflow</a></li>
              </ul>
            </li>
            <li><a href="#3-multi-repository-artifact-management">3. Multi-Repository Artifact Management</a>
              <ul>
                <li><a href="#the-challenge">The Challenge</a></li>
                <li><a href="#kargos-solution-freight-bundles">Kargo&rsquo;s Solution: Freight Bundles</a></li>
                <li><a href="#comparison-to-traditional-unified-versioning">Comparison to Traditional Unified Versioning</a></li>
                <li><a href="#handling-incompatible-combinations">Handling Incompatible Combinations</a></li>
              </ul>
            </li>
            <li><a href="#4-combining-and-manipulating-freight">4. Combining and Manipulating Freight</a>
              <ul>
                <li><a href="#can-you-combine-freight-after-creation">Can You Combine Freight After Creation?</a></li>
              </ul>
            </li>
            <li><a href="#5-external-release-tracking">5. External Release Tracking</a>
              <ul>
                <li><a href="#the-challenge-1">The Challenge</a></li>
                <li><a href="#creating-tags-for-external-tracking">Creating Tags for External Tracking</a></li>
              </ul>
            </li>
            <li><a href="#6-promotion-templates-and-tasks">6. Promotion Templates and Tasks</a>
              <ul>
                <li><a href="#promotion-templates">Promotion Templates</a></li>
                <li><a href="#promotion-tasks">Promotion Tasks</a></li>
              </ul>
            </li>
            <li><a href="#7-warehouse-configuration-patterns">7. Warehouse Configuration Patterns</a>
              <ul>
                <li><a href="#subscription-types">Subscription Types</a></li>
                <li><a href="#selection-strategies">Selection Strategies</a></li>
                <li><a href="#freight-creation-policies">Freight Creation Policies</a></li>
              </ul>
            </li>
            <li><a href="#8-progressive-delivery-patterns">8. Progressive Delivery Patterns</a>
              <ul>
                <li><a href="#common-case-pattern">Common Case Pattern</a></li>
                <li><a href="#grouped-services-pattern">Grouped Services Pattern</a></li>
                <li><a href="#independent-pipelines-pattern">Independent Pipelines Pattern</a></li>
                <li><a href="#gatekeeper-stage-pattern">Gatekeeper Stage Pattern</a></li>
              </ul>
            </li>
            <li><a href="#9-verification-and-health-monitoring">9. Verification and Health Monitoring</a>
              <ul>
                <li><a href="#stage-health">Stage Health</a></li>
                <li><a href="#health-check-registration">Health Check Registration</a></li>
                <li><a href="#verification">Verification</a></li>
              </ul>
            </li>
            <li><a href="#10-storage-and-branch-strategies">10. Storage and Branch Strategies</a>
              <ul>
                <li><a href="#stage-specific-branches">Stage-Specific Branches</a></li>
                <li><a href="#single-branch-with-paths">Single Branch with Paths</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#architectural-principles">Architectural Principles</a>
          <ul>
            <li><a href="#gitops-compliance">GitOps Compliance</a></li>
            <li><a href="#separation-of-concerns">Separation of Concerns</a></li>
            <li><a href="#state-driven-vs-event-driven">State-Driven vs. Event-Driven</a></li>
            <li><a href="#multi-tenancy">Multi-Tenancy</a></li>
          </ul>
        </li>
        <li><a href="#best-practices">Best Practices</a>
          <ul>
            <li><a href="#1-repository-structure">1. Repository Structure</a></li>
            <li><a href="#2-freight-creation">2. Freight Creation</a></li>
            <li><a href="#3-promotion-workflows">3. Promotion Workflows</a></li>
            <li><a href="#4-health-and-verification">4. Health and Verification</a></li>
            <li><a href="#5-security-and-access-control">5. Security and Access Control</a></li>
            <li><a href="#6-external-tracking">6. External Tracking</a></li>
          </ul>
        </li>
        <li><a href="#common-pitfalls-and-solutions">Common Pitfalls and Solutions</a>
          <ul>
            <li><a href="#pitfall-1-freight-with-incompatible-versions">Pitfall 1: Freight with Incompatible Versions</a></li>
            <li><a href="#pitfall-2-feedback-loops">Pitfall 2: Feedback Loops</a></li>
            <li><a href="#pitfall-3-lost-freight-context">Pitfall 3: Lost Freight Context</a></li>
            <li><a href="#pitfall-4-slow-artifact-discovery">Pitfall 4: Slow Artifact Discovery</a></li>
            <li><a href="#pitfall-5-argocd-application-not-syncing">Pitfall 5: ArgoCD Application Not Syncing</a></li>
          </ul>
        </li>
        <li><a href="#appendices">Appendices</a>
          <ul>
            <li><a href="#appendix-a-complete-warehouse-examples">Appendix A: Complete Warehouse Examples</a>
              <ul>
                <li><a href="#a1-single-image-subscription">A.1 Single Image Subscription</a></li>
                <li><a href="#a2-multi-repository-subscription-with-criteria">A.2 Multi-Repository Subscription with Criteria</a></li>
                <li><a href="#a3-manual-freight-assembly-configuration">A.3 Manual Freight Assembly Configuration</a></li>
                <li><a href="#a4-git-repository-with-path-filters">A.4 Git Repository with Path Filters</a></li>
              </ul>
            </li>
            <li><a href="#appendix-b-stage-configuration-examples">Appendix B: Stage Configuration Examples</a>
              <ul>
                <li><a href="#b1-development-stage-with-auto-promotion">B.1 Development Stage with Auto-Promotion</a></li>
                <li><a href="#b2-production-stage-with-manual-approval">B.2 Production Stage with Manual Approval</a></li>
                <li><a href="#b3-stage-using-multiple-warehouses">B.3 Stage Using Multiple Warehouses</a></li>
              </ul>
            </li>
            <li><a href="#appendix-c-argocd-application-examples">Appendix C: ArgoCD Application Examples</a>
              <ul>
                <li><a href="#c1-basic-application-with-kargo-authorization">C.1 Basic Application with Kargo Authorization</a></li>
                <li><a href="#c2-applicationset-for-multiple-stages">C.2 ApplicationSet for Multiple Stages</a></li>
                <li><a href="#c3-multi-source-application">C.3 Multi-Source Application</a></li>
              </ul>
            </li>
            <li><a href="#appendix-d-promotion-task-examples">Appendix D: Promotion Task Examples</a>
              <ul>
                <li><a href="#d1-reusable-git-update-task">D.1 Reusable Git Update Task</a></li>
                <li><a href="#d2-using-promotion-task-in-stage">D.2 Using Promotion Task in Stage</a></li>
                <li><a href="#d3-pull-request-workflow-task">D.3 Pull Request Workflow Task</a></li>
              </ul>
            </li>
            <li><a href="#appendix-e-advanced-configuration-examples">Appendix E: Advanced Configuration Examples</a>
              <ul>
                <li><a href="#e1-freight-clone-for-hotfix">E.1 Freight Clone for Hotfix</a></li>
                <li><a href="#e2-release-tagging-with-complete-manifest">E.2 Release Tagging with Complete Manifest</a></li>
                <li><a href="#e3-notification-integration">E.3 Notification Integration</a></li>
              </ul>
            </li>
            <li><a href="#appendix-f-troubleshooting-guide">Appendix F: Troubleshooting Guide</a>
              <ul>
                <li><a href="#f1-freight-not-being-created">F.1 Freight Not Being Created</a></li>
                <li><a href="#f2-promotion-failing">F.2 Promotion Failing</a></li>
                <li><a href="#f3-argocd-application-not-syncing">F.3 ArgoCD Application Not Syncing</a></li>
                <li><a href="#f4-stage-health-reporting-degraded">F.4 Stage Health Reporting Degraded</a></li>
              </ul>
            </li>
            <li><a href="#appendix-g-expression-reference">Appendix G: Expression Reference</a>
              <ul>
                <li><a href="#g1-context-variables">G.1 Context Variables</a></li>
                <li><a href="#g2-artifact-functions">G.2 Artifact Functions</a></li>
                <li><a href="#g3-variable-references">G.3 Variable References</a></li>
                <li><a href="#g4-utility-functions">G.4 Utility Functions</a></li>
                <li><a href="#g5-freight-creation-criteria-examples">G.5 Freight Creation Criteria Examples</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#conclusion">Conclusion</a></li>
        <li><a href="#additional-resources">Additional Resources</a></li>
      </ul>
    </li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















