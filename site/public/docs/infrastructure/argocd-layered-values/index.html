<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ArgoCD and Helm Schema Validation is a infrastructure document covering ArgoCD and Helm Schema Validation and How ArgoCD Uses Helm Schema Validation. This resource provides information and guidance on the topic. See the full document for detailed information and implementation details."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://lago-morph.github.io/musings/docs/infrastructure/argocd-layered-values/"><meta property="og:site_name" content="Technology Documentation Hub"><meta property="og:title" content="ArgoCD and Helm Schema Validation"><meta property="og:description" content="ArgoCD and Helm Schema Validation is a infrastructure document covering ArgoCD and Helm Schema Validation and How ArgoCD Uses Helm Schema Validation. This resource provides information and guidance on the topic. See the full document for detailed information and implementation details."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-16T00:00:00+00:00"><meta itemprop=name content="ArgoCD and Helm Schema Validation"><meta itemprop=description content="ArgoCD and Helm Schema Validation is a infrastructure document covering ArgoCD and Helm Schema Validation and How ArgoCD Uses Helm Schema Validation. This resource provides information and guidance on the topic. See the full document for detailed information and implementation details."><meta itemprop=datePublished content="2025-12-16T00:00:00+00:00"><meta itemprop=dateModified content="2025-12-16T00:00:00+00:00"><meta itemprop=wordCount content="983"><meta itemprop=keywords content="yaml,argocd,helm,platform,api,production,kubernetes,staging"><title>ArgoCD and Helm Schema Validation | Technology Documentation Hub</title><link rel=icon href=/musings/favicon.png><link rel=manifest href=/musings/manifest.json><link rel=canonical href=https://lago-morph.github.io/musings/docs/infrastructure/argocd-layered-values/><link rel=stylesheet href=/musings/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG+T2l66Bw7pV8=" crossorigin=anonymous><script defer src=/musings/fuse.min.js></script><script defer src=/musings/en.search.min.5cc9128683126c7cda9fef74044c10c013f6d8935e1e3e719e3f562033e9ef44.js integrity="sha256-XMkShoMSbHzan+90BEwQwBP22JNeHj5xnj9WIDPp70Q=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/musings/><span>Technology Documentation Hub</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/musings/docs/ai-ml/>AI & Machine Learning</a><ul><li><a href=/musings/docs/ai-ml/agentic-computing-overview-and-tools/>Agentic Computing Overview And Tools</a></li><li><a href=/musings/docs/ai-ml/agno-vs-langchain/>Agno Vs Langchain</a></li><li><a href=/musings/docs/ai-ml/flowwise-vs-langflow/>Flowise vs Langflow: Detailed Comparison</a></li><li><a href=/musings/docs/ai-ml/one-model-multiple-diagrams/>Generate all views</a></li><li><a href=/musings/docs/ai-ml/verification-architecture/>Is This a Reasonable Architecture?</a></li><li><a href=/musings/docs/ai-ml/kiro-ide-comparison-tools/>Kiro IDE: Comprehensive Analysis, Comparisons & Optimal Workflows</a></li><li><a href=/musings/docs/ai-ml/langchain-architecture/>LangChain: The Foundation Library</a></li><li><a href=/musings/docs/ai-ml/llm-tracing-metrics-comparison/>Llm Tracing Metrics Comparison</a></li><li><a href=/musings/docs/ai-ml/kubernetes-based/>Open Source Workflow Orchestration on Kubernetes</a></li><li><a href=/musings/docs/ai-ml/tools-overview-and-getting-started/>Self-Hosted Open Source Agent Tools</a></li><li><a href=/musings/docs/ai-ml/serverless-function-workflow-tools-for-kubernetes/>Serverless/Function Workflows on Kubernetes</a></li><li><a href=/musings/docs/ai-ml/n8n-overview/>What Problems Does n8n Solve?</a></li></ul></li><li><a href=/musings/docs/devplatform/>Development Platforms</a><ul><li><a href=/musings/docs/devplatform/backstage-techdocs-pros-cons/>Backstage Techdocs Pros Cons</a></li><li><a href=/musings/docs/devplatform/cross-diagram-reuse-guide/>Cross-Diagram Domain Model Reuse in PlantUML</a></li><li><a href=/musings/docs/devplatform/prompt/>Crossplane EKS Management Cluster Implementation - Project Brief</a></li><li><a href=/musings/docs/devplatform/comprehensive-guide/>Driven vs Event: Comparison</a></li><li><a href=/musings/docs/devplatform/gitops-platform-safety/>GitOps Safety Architecture for Platform Evolution</a></li><li><a href=/musings/docs/devplatform/kargo-intro/>How Kargo Works with ArgoCD to Manage Deployments</a></li><li><a href=/musings/docs/devplatform/backstage-kratix-crossplane-argocd-blueprint/>Implementation Blueprint: Crossplane + Kratix + Backstage + ArgoCD</a></li><li><a href=/musings/docs/devplatform/kargo-git-tags/>In subsequent stages, you can read this metadata</a></li><li><a href=/musings/docs/devplatform/in-browser-editing-tools/>In-Browser Editing Documentation Solutions</a></li><li><a href=/musings/docs/devplatform/initial-comparison/>Initial Comparison</a></li><li><a href=/musings/docs/devplatform/kargo-argocd-interaction/>Kargo promotion step</a></li><li><a href=/musings/docs/devplatform/presentation/>Kargo: GitOps Promotion for ArgoCD</a></li><li><a href=/musings/docs/devplatform/notion-overview/>Notion: A Comprehensive Overview</a></li><li><a href=/musings/docs/devplatform/oss-portal-platform-orchestration-tools/>Oss Portal Platform Orchestration Tools</a></li><li><a href=/musings/docs/devplatform/oss-vs-closed-portal/>Oss Vs Closed Portal</a></li><li><a href=/musings/docs/devplatform/recommendations/>Overview of Text-Based UML Domain Modeling Tools</a></li><li><a href=/musings/docs/devplatform/export-conversion/>PlantUML Export & Embedding Options</a></li><li><a href=/musings/docs/devplatform/crossplane-solution/>Pseudocode for composition function</a></li><li><a href=/musings/docs/devplatform/kargo-polyrepo/>Response</a></li><li><a href=/musings/docs/devplatform/job-configmap-crossplane-abstraction/>Shell script helper for Option 3</a></li><li><a href=/musings/docs/devplatform/tasks/>Stage 1: Approach Overview & Comparison ‚úÖ COMPLETE</a></li><li><a href=/musings/docs/devplatform/stage3-outline/>Stage 3: Implementation Patterns - Outline (Crossplane 2.1)</a></li></ul></li><li><a href=/musings/docs/infrastructure/>Infrastructure</a><ul><li><a href=/musings/docs/infrastructure/runbooks/>1. Mental Model Shift (Important Framing)</a></li><li><a href=/musings/docs/infrastructure/argocd-layered-values/ class=active>ArgoCD and Helm Schema Validation</a></li><li><a href=/musings/docs/infrastructure/prompt-guide/>Contents</a></li><li><a href=/musings/docs/infrastructure/overview/>Core Strategy: Progressive Delivery with Blast Radius Containment</a></li><li><a href=/musings/docs/infrastructure/stage1/>Crossplane EKS Management Cluster - Approach Overview & Comparison</a></li><li><a href=/musings/docs/infrastructure/getting-started-concise/>Getting Started Concise</a></li><li><a href=/musings/docs/infrastructure/ci-cd-templates/>GitHub Actions Example</a></li><li><a href=/musings/docs/infrastructure/k8s-mcp-servers/>K8s Mcp Servers</a></li><li><a href=/musings/docs/infrastructure/stage2/>Management Cluster VPC Layout</a></li><li><a href=/musings/docs/infrastructure/non-helm-schema-validation/>Non Helm Schema Validation</a></li><li><a href=/musings/docs/infrastructure/production-readiness-overview/>Production Readiness Guide: From Docker Compose to Kubernetes</a></li><li><a href=/musings/docs/infrastructure/schema-testing/>Quick Start: Generate Schema from Existing values.yaml</a></li><li><a href=/musings/docs/infrastructure/job-plus-configmap-annotation/>Read current state AND capture resourceVersion</a></li><li><a href=/musings/docs/infrastructure/layered-schema/>Schema Validation with Layered Values Files</a></li><li><a href=/musings/docs/infrastructure/helm-layered-abstraction/>Solution 2: Kustomize with Helm</a></li><li><a href=/musings/docs/infrastructure/starting-helm-testing/>Understanding What You're Testing</a></li><li><a href=/musings/docs/infrastructure/executive-summary/>What You're Building</a></li><li><a href=/musings/docs/infrastructure/devops-domain-model-guide/>Why This Approach Works for DevOps</a></li></ul></li><li><a href=/musings/docs/workflows/>Workflows</a><ul><li><a href=/musings/docs/workflows/imperitive-in-declarative/>Imperitive In Declarative</a></li></ul></li><li><a href=/musings/docs/mermaid-test/>Mermaid Diagram Test</a></li><li><a href=/musings/docs/misc/>Miscellaneous</a><ul></ul></li><li><a href=/musings/docs/test-document/>Test Document</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/musings/icons/menu.svg class=book-icon alt=Menu></label><h3>ArgoCD and Helm Schema Validation</h3><label for=toc-control><img src=/musings/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#argocd-and-helm-schema-validation>ArgoCD and Helm Schema Validation</a><ul><li><a href=#how-argocd-uses-helm-schema-validation><strong>How ArgoCD Uses Helm Schema Validation</strong></a></li><li><a href=#the-critical-timing-difference><strong>The Critical Timing Difference</strong></a><ul><li><a href=#standalone-helm>Standalone Helm:</a></li><li><a href=#argocd>ArgoCD:</a></li></ul></li><li><a href=#where-this-matters-for-your-layered-values><strong>Where This Matters for Your Layered Values</strong></a><ul><li><a href=#scenario-1-values-in-argocd-application-manifest>Scenario 1: Values in ArgoCD Application Manifest</a></li><li><a href=#scenario-2-values-in-different-reposconfigmaps>Scenario 2: Values in Different Repos/ConfigMaps</a><ul><li><a href=#pattern-a-values-file--argocd-parameters>Pattern A: Values File + ArgoCD Parameters</a></li><li><a href=#pattern-b-values-in-external-configmapsecret>Pattern B: Values in External ConfigMap/Secret</a></li></ul></li></ul></li><li><a href=#argocd-specific-considerations><strong>ArgoCD-Specific Considerations</strong></a><ul><li><a href=#1-server-side-vs-client-side-rendering>1. <strong>Server-Side vs. Client-Side Rendering</strong></a><ul><li><a href=#client-side-default>Client-Side (Default):</a></li><li><a href=#server-side>Server-Side:</a></li></ul></li><li><a href=#2-multi-source-applications-argocd-26>2. <strong>Multi-Source Applications (ArgoCD 2.6+)</strong></a></li><li><a href=#3-app-of-apps-pattern>3. <strong>App of Apps Pattern</strong></a></li></ul></li><li><a href=#when-schema-validation-fails-in-argocd><strong>When Schema Validation Fails in ArgoCD</strong></a><ul><li><a href=#the-error-flow>The Error Flow:</a></li></ul></li><li><a href=#key-differences-from-standalone-helm><strong>Key Differences from Standalone Helm</strong></a></li><li><a href=#best-practices-for-argocd--layered-values><strong>Best Practices for ArgoCD + Layered Values</strong></a><ul><li><a href=#1-use-multi-source-for-clean-separation>1. <strong>Use Multi-Source for Clean Separation</strong></a></li><li><a href=#2-test-locally-first>2. <strong>Test Locally First</strong></a></li><li><a href=#3-use-argocd-application-sets-for-multiple-environments>3. <strong>Use ArgoCD Application Sets for Multiple Environments</strong></a></li><li><a href=#4-configure-sync-policies-carefully>4. <strong>Configure Sync Policies Carefully</strong></a></li></ul></li><li><a href=#monitoring-schema-validation-in-argocd><strong>Monitoring Schema Validation in ArgoCD</strong></a><ul><li><a href=#argocd-notifications-for-schema-failures>ArgoCD Notifications for Schema Failures</a></li><li><a href=#prometheus-metrics>Prometheus Metrics</a></li></ul></li><li><a href=#the-bottom-line><strong>The Bottom Line</strong></a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=argocd-and-helm-schema-validation>ArgoCD and Helm Schema Validation<a class=anchor href=#argocd-and-helm-schema-validation>#</a></h1><p><strong>Short answer:</strong> Yes, but with important caveats about <strong>when</strong> and <strong>how</strong>.</p><hr><h2 id=how-argocd-uses-helm-schema-validation><strong>How ArgoCD Uses Helm Schema Validation</strong><a class=anchor href=#how-argocd-uses-helm-schema-validation>#</a></h2><p>ArgoCD uses the native Helm client under the hood, which means:</p><ol><li><p><strong>During sync</strong>, ArgoCD runs essentially:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm template &lt;release&gt; &lt;chart&gt; -f values.yaml -f overrides.yaml</span></span></code></pre></div></li><li><p><strong>Helm&rsquo;s schema validation happens</strong> as part of template rendering</p></li><li><p><strong>If schema validation fails</strong>, the sync fails and ArgoCD reports the error</p></li></ol><p><strong>So yes, ArgoCD respects <code>values.schema.json</code>.</strong></p><hr><h2 id=the-critical-timing-difference><strong>The Critical Timing Difference</strong><a class=anchor href=#the-critical-timing-difference>#</a></h2><h3 id=standalone-helm>Standalone Helm:<a class=anchor href=#standalone-helm>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install myapp ./chart -f values.yaml</span></span></code></pre></div><ul><li>Schema validation happens <strong>before</strong> any Kubernetes API calls</li><li><strong>Fail fast:</strong> Bad values = immediate error, nothing deployed</li></ul><h3 id=argocd>ArgoCD:<a class=anchor href=#argocd>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ArgoCD syncs the application</span></span></span></code></pre></div><ul><li>Schema validation happens during the <strong>sync phase</strong></li><li>Might reach <strong>DEGRADED</strong> state if validation fails</li><li>Could have <strong>partial resources</strong> created before failure (depending on sync waves)</li></ul><hr><h2 id=where-this-matters-for-your-layered-values><strong>Where This Matters for Your Layered Values</strong><a class=anchor href=#where-this-matters-for-your-layered-values>#</a></h2><h3 id=scenario-1-values-in-argocd-application-manifest>Scenario 1: Values in ArgoCD Application Manifest<a class=anchor href=#scenario-1-values-in-argocd-application-manifest>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/org/charts</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>charts/myapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>values.yaml</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>platform.yaml </span> <span style=color:#75715e># Your override file</span></span></span></code></pre></div><p><strong>What happens:</strong></p><ul><li>ArgoCD passes both files to Helm in order</li><li>Helm merges them: <code>values.yaml</code> + <code>platform.yaml</code></li><li>Schema validates the <strong>merged result</strong></li><li>‚úÖ Works exactly like running <code>helm install -f values.yaml -f platform.yaml</code></li></ul><hr><h3 id=scenario-2-values-in-different-reposconfigmaps>Scenario 2: Values in Different Repos/ConfigMaps<a class=anchor href=#scenario-2-values-in-different-reposconfigmaps>#</a></h3><p><strong>This is where it gets tricky with your layered approach.</strong></p><h4 id=pattern-a-values-file--argocd-parameters>Pattern A: Values File + ArgoCD Parameters<a class=anchor href=#pattern-a-values-file--argocd-parameters>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>values.yaml</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>parameters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>database.password</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;secret-from-vault&#34;</span></span></span></code></pre></div><p><strong>What happens:</strong></p><ul><li>Helm merges <code>values.yaml</code> + parameters</li><li>Schema validation sees merged result</li><li>‚úÖ If database.password is in parameters, validation passes</li></ul><h4 id=pattern-b-values-in-external-configmapsecret>Pattern B: Values in External ConfigMap/Secret<a class=anchor href=#pattern-b-values-in-external-configmapsecret>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>values.yaml</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>secrets://mysecret/platform-values </span> <span style=color:#75715e># External values</span></span></span></code></pre></div><p><strong>What happens:</strong></p><ul><li>ArgoCD resolves the secret/configmap</li><li>Passes both files to Helm</li><li>‚úÖ Schema validates merged result</li></ul><hr><h2 id=argocd-specific-considerations><strong>ArgoCD-Specific Considerations</strong><a class=anchor href=#argocd-specific-considerations>#</a></h2><h3 id=1-server-side-vs-client-side-rendering>1. <strong>Server-Side vs. Client-Side Rendering</strong><a class=anchor href=#1-server-side-vs-client-side-rendering>#</a></h3><p>ArgoCD has two modes:</p><h4 id=client-side-default>Client-Side (Default):<a class=anchor href=#client-side-default>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>skipCrds</span>: <span style=color:#66d9ef>false</span></span></span></code></pre></div><ul><li>Helm runs <strong>on the ArgoCD server</strong></li><li>Schema validation happens on ArgoCD server</li><li>Same behavior as local <code>helm template</code></li></ul><h4 id=server-side>Server-Side:<a class=anchor href=#server-side>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>skipCrds</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>syncPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>syncOptions</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ServerSideApply=true</span></span></span></code></pre></div><ul><li>Kubernetes handles the apply</li><li>But Helm <strong>still renders</strong> the template first</li><li>Schema validation <strong>still happens</strong></li></ul><hr><h3 id=2-multi-source-applications-argocd-26>2. <strong>Multi-Source Applications (ArgoCD 2.6+)</strong><a class=anchor href=#2-multi-source-applications-argocd-26>#</a></h3><p>This is <strong>game-changing</strong> for your layered values pattern:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>sources</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Source 1: The Helm chart</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/org/charts</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>charts/myapp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetRevision</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>values.yaml</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>$values/platform-config/production/platform.yaml</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Source 2: Platform values repository</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/org/platform-config</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>targetRevision</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ref</span>: <span style=color:#ae81ff>values</span></span></span></code></pre></div><p><strong>What happens:</strong></p><ul><li>ArgoCD fetches both repos</li><li>Merges values from both sources</li><li>Passes merged values to Helm</li><li>‚úÖ Schema validates the final merged result</li></ul><p><strong>This solves the &ldquo;values in different repos&rdquo; problem cleanly.</strong></p><hr><h3 id=3-app-of-apps-pattern>3. <strong>App of Apps Pattern</strong><a class=anchor href=#3-app-of-apps-pattern>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Root application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>platform-apps</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/org/platform</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>applications</span></span></span></code></pre></div><p>Where <code>applications/</code> contains:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># applications/myapp.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>../../base-values/values.yaml</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>../../platform-values/production/platform.yaml</span></span></span></code></pre></div><p><strong>What happens:</strong></p><ul><li>Each child app has its value file references</li><li>Helm merges them per application</li><li>‚úÖ Schema validation works per app</li></ul><hr><h2 id=when-schema-validation-fails-in-argocd><strong>When Schema Validation Fails in ArgoCD</strong><a class=anchor href=#when-schema-validation-fails-in-argocd>#</a></h2><h3 id=the-error-flow>The Error Flow:<a class=anchor href=#the-error-flow>#</a></h3><ol><li><strong>ArgoCD detects out of sync</strong></li><li><strong>Attempts sync</strong></li><li><strong>Helm renders template</strong> (schema validation happens here)</li><li><strong>Schema validation fails</strong></li><li><strong>ArgoCD shows error:</strong><pre tabindex=0><code>ComparisonError
rpc error: code = Unknown desc = 
Helm template rendering failed: values don&#39;t meet the 
specifications of the schema(s) in the following chart(s):
myapp:
- database.password: Invalid type. Expected: string, given: null</code></pre></li><li><strong>Application status:</strong> <code>OutOfSync</code> and <code>Degraded</code></li><li><strong>No resources applied</strong> (template rendering failed before apply)</li></ol><hr><h2 id=key-differences-from-standalone-helm><strong>Key Differences from Standalone Helm</strong><a class=anchor href=#key-differences-from-standalone-helm>#</a></h2><table><thead><tr><th>Aspect</th><th>Standalone Helm</th><th>ArgoCD with Helm</th></tr></thead><tbody><tr><td><strong>When validation runs</strong></td><td>Before any K8s calls</td><td>During sync phase</td></tr><tr><td><strong>Failure impact</strong></td><td>Installation aborted</td><td>Sync fails, app degraded</td></tr><tr><td><strong>Retry behavior</strong></td><td>Manual only</td><td>Auto-retry if configured</td></tr><tr><td><strong>Error visibility</strong></td><td>CLI output</td><td>ArgoCD UI + notifications</td></tr><tr><td><strong>Values source</strong></td><td>Local files only</td><td>Repos, ConfigMaps, Secrets, Plugins</td></tr><tr><td><strong>Multi-source values</strong></td><td>Not supported</td><td>Supported (v2.6+)</td></tr></tbody></table><hr><h2 id=best-practices-for-argocd--layered-values><strong>Best Practices for ArgoCD + Layered Values</strong><a class=anchor href=#best-practices-for-argocd--layered-values>#</a></h2><h3 id=1-use-multi-source-for-clean-separation>1. <strong>Use Multi-Source for Clean Separation</strong><a class=anchor href=#1-use-multi-source-for-clean-separation>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>sources</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>&lt;chart-repo&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>values.yaml </span> <span style=color:#75715e># Base</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>$platform/production.yaml </span> <span style=color:#75715e># Platform layer</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>&lt;platform-repo&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ref</span>: <span style=color:#ae81ff>platform</span></span></span></code></pre></div><h3 id=2-test-locally-first>2. <strong>Test Locally First</strong><a class=anchor href=#2-test-locally-first>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Simulate what ArgoCD will do</span>
</span></span><span style=display:flex><span>helm template myapp ./chart <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -f ../platform-config/production/platform.yaml</span></span></code></pre></div><h3 id=3-use-argocd-application-sets-for-multiple-environments>3. <strong>Use ArgoCD Application Sets for Multiple Environments</strong><a class=anchor href=#3-use-argocd-application-sets-for-multiple-environments>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ApplicationSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp-environments</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>generators</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>list</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>elements</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>env</span>: <span style=color:#ae81ff>dev</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>dev-platform.yaml</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>env</span>: <span style=color:#ae81ff>staging</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>staging-platform.yaml</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>env</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>platform</span>: <span style=color:#ae81ff>production-platform.yaml</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFiles</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>values.yaml</span>
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#39;{{platform}}&#39;</span></span></span></code></pre></div><p>Each environment gets the right platform.yaml, schema validates each separately.</p><h3 id=4-configure-sync-policies-carefully>4. <strong>Configure Sync Policies Carefully</strong><a class=anchor href=#4-configure-sync-policies-carefully>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>syncPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>automated</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>selfHeal</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>syncOptions</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>CreateNamespace=true</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>PruneLast=true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>retry</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>limit</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>backoff</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>factor</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>maxDuration</span>: <span style=color:#ae81ff>3m</span></span></span></code></pre></div><p>If schema validation fails, ArgoCD will retry based on this config.</p><hr><h2 id=monitoring-schema-validation-in-argocd><strong>Monitoring Schema Validation in ArgoCD</strong><a class=anchor href=#monitoring-schema-validation-in-argocd>#</a></h2><h3 id=argocd-notifications-for-schema-failures>ArgoCD Notifications for Schema Failures<a class=anchor href=#argocd-notifications-for-schema-failures>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>argocd-notifications-cm</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>trigger.on-schema-error</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - when: app.status.operationState.phase == &#39;Error&#39; &amp;&amp; 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            app.status.operationState.message contains &#39;schema&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      send: [slack-platform-team]</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>template.schema-error</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    message: |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      üö® Schema Validation Failed
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      App: {{.app.metadata.name}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Error: {{.app.status.operationState.message}}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      This usually means platform.yaml is missing required overrides.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      Check: https://wiki.company.com/platform-values-guide</span></span></span></code></pre></div><h3 id=prometheus-metrics>Prometheus Metrics<a class=anchor href=#prometheus-metrics>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#75715e># Count of apps with schema errors</span>
</span></span><span style=display:flex><span>argocd_app_info{sync_status<span style=color:#f92672>=</span>&#34;<span style=color:#e6db74>OutOfSync</span>&#34;, health_status<span style=color:#f92672>=</span>&#34;<span style=color:#e6db74>Degraded</span>&#34;} 
</span></span><span style=display:flex><span>  <span style=color:#f92672>and</span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>on</span><span style=color:#f92672>(</span>name<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>  argocd_app_sync_total{phase<span style=color:#f92672>=</span>&#34;<span style=color:#e6db74>Error</span>&#34;}</span></span></code></pre></div><hr><h2 id=the-bottom-line><strong>The Bottom Line</strong><a class=anchor href=#the-bottom-line>#</a></h2><p><strong>Yes, ArgoCD uses Helm schema validation</strong>, and it works <strong>exactly like</strong> running <code>helm template</code> with your merged values files.</p><p><strong>For your layered values approach:</strong></p><ul><li>‚úÖ ArgoCD merges values.yaml + platform.yaml before validation</li><li>‚úÖ Schema sees the final merged result</li><li>‚úÖ Works the same as standalone Helm</li><li>‚úÖ Multi-source apps (ArgoCD 2.6+) make this pattern clean</li><li>‚ö†Ô∏è Validation failures show in ArgoCD UI, not CLI</li><li>‚ö†Ô∏è Set up notifications for schema errors</li><li>‚ö†Ô∏è Test locally first to catch errors before committing</li></ul><p><strong>The schema strategy I showed you (EXAMPLE-13 with sentinel values) works perfectly with ArgoCD</strong> because:</p><ol><li>Chart packages with sentinel values in values.yaml</li><li>ArgoCD merges values.yaml + platform.yaml</li><li>Helm validates merged result</li><li>Schema catches any remaining sentinel values (= missing overrides)</li><li>Clear error message in ArgoCD UI</li></ol><p>No special ArgoCD configuration needed‚Äîit just works.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/musings/docs/infrastructure/runbooks/ class="flex align-center"><img src=/musings/icons/backward.svg class=book-icon alt=Backward>
<span>1. Mental Model Shift (Important Framing)</span>
</a></span><span><a href=/musings/docs/infrastructure/prompt-guide/ class="flex align-center"><span>Contents</span>
<img src=/musings/icons/forward.svg class=book-icon alt=Forward></a></span></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#argocd-and-helm-schema-validation>ArgoCD and Helm Schema Validation</a><ul><li><a href=#how-argocd-uses-helm-schema-validation><strong>How ArgoCD Uses Helm Schema Validation</strong></a></li><li><a href=#the-critical-timing-difference><strong>The Critical Timing Difference</strong></a><ul><li><a href=#standalone-helm>Standalone Helm:</a></li><li><a href=#argocd>ArgoCD:</a></li></ul></li><li><a href=#where-this-matters-for-your-layered-values><strong>Where This Matters for Your Layered Values</strong></a><ul><li><a href=#scenario-1-values-in-argocd-application-manifest>Scenario 1: Values in ArgoCD Application Manifest</a></li><li><a href=#scenario-2-values-in-different-reposconfigmaps>Scenario 2: Values in Different Repos/ConfigMaps</a><ul><li><a href=#pattern-a-values-file--argocd-parameters>Pattern A: Values File + ArgoCD Parameters</a></li><li><a href=#pattern-b-values-in-external-configmapsecret>Pattern B: Values in External ConfigMap/Secret</a></li></ul></li></ul></li><li><a href=#argocd-specific-considerations><strong>ArgoCD-Specific Considerations</strong></a><ul><li><a href=#1-server-side-vs-client-side-rendering>1. <strong>Server-Side vs. Client-Side Rendering</strong></a><ul><li><a href=#client-side-default>Client-Side (Default):</a></li><li><a href=#server-side>Server-Side:</a></li></ul></li><li><a href=#2-multi-source-applications-argocd-26>2. <strong>Multi-Source Applications (ArgoCD 2.6+)</strong></a></li><li><a href=#3-app-of-apps-pattern>3. <strong>App of Apps Pattern</strong></a></li></ul></li><li><a href=#when-schema-validation-fails-in-argocd><strong>When Schema Validation Fails in ArgoCD</strong></a><ul><li><a href=#the-error-flow>The Error Flow:</a></li></ul></li><li><a href=#key-differences-from-standalone-helm><strong>Key Differences from Standalone Helm</strong></a></li><li><a href=#best-practices-for-argocd--layered-values><strong>Best Practices for ArgoCD + Layered Values</strong></a><ul><li><a href=#1-use-multi-source-for-clean-separation>1. <strong>Use Multi-Source for Clean Separation</strong></a></li><li><a href=#2-test-locally-first>2. <strong>Test Locally First</strong></a></li><li><a href=#3-use-argocd-application-sets-for-multiple-environments>3. <strong>Use ArgoCD Application Sets for Multiple Environments</strong></a></li><li><a href=#4-configure-sync-policies-carefully>4. <strong>Configure Sync Policies Carefully</strong></a></li></ul></li><li><a href=#monitoring-schema-validation-in-argocd><strong>Monitoring Schema Validation in ArgoCD</strong></a><ul><li><a href=#argocd-notifications-for-schema-failures>ArgoCD Notifications for Schema Failures</a></li><li><a href=#prometheus-metrics>Prometheus Metrics</a></li></ul></li><li><a href=#the-bottom-line><strong>The Bottom Line</strong></a></li></ul></li></ul></nav></div></aside></main></body></html>