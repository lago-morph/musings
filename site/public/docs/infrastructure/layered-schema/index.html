<!DOCTYPE html>
<html lang="en" dir="ltr">
<head><script src="/musings/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=musings/livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Schema Validation with Layered Values Files is a infrastructure document covering Schema Validation with Layered Values Files and The Core Challenge. This resource provides information and guidance on the topic. See the full document for detailed information and implementation details.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/musings/docs/infrastructure/layered-schema/">
  <meta property="og:site_name" content="Technology Documentation Hub">
  <meta property="og:title" content="Schema Validation with Layered Values Files">
  <meta property="og:description" content="Schema Validation with Layered Values Files is a infrastructure document covering Schema Validation with Layered Values Files and The Core Challenge. This resource provides information and guidance on the topic. See the full document for detailed information and implementation details.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2025-12-16T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-12-16T00:00:00+00:00">


  <meta itemprop="name" content="Schema Validation with Layered Values Files">
  <meta itemprop="description" content="Schema Validation with Layered Values Files is a infrastructure document covering Schema Validation with Layered Values Files and The Core Challenge. This resource provides information and guidance on the topic. See the full document for detailed information and implementation details.">
  <meta itemprop="datePublished" content="2025-12-16T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-12-16T00:00:00+00:00">
  <meta itemprop="wordCount" content="1677">
  <meta itemprop="keywords" content="yaml,platform,database,helm,json,deployment,production,api">

<title>Schema Validation with Layered Values Files | Technology Documentation Hub</title>
<link rel="icon" href="/musings/favicon.png" >
<link rel="manifest" href="/musings/manifest.json">
<link rel="canonical" href="http://localhost:1313/musings/docs/infrastructure/layered-schema/">
<link rel="stylesheet" href="/musings/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/musings/fuse.min.js"></script>
  <script defer src="/musings/en.search.min.5cc9128683126c7cda9fef74044c10c013f6d8935e1e3e719e3f562033e9ef44.js" integrity="sha256-XMkShoMSbHzan&#43;90BEwQwBP22JNeHj5xnj9WIDPp70Q=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/musings/"><span>Technology Documentation Hub</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/" class="">
      AI &amp; Machine Learning</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/agentic-computing-overview-and-tools/" class="">
      Agentic Computing Overview And Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/agno-vs-langchain/" class="">
      Agno Vs Langchain</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/flowwise-vs-langflow/" class="">
      Flowise vs Langflow: Detailed Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/one-model-multiple-diagrams/" class="">
      Generate all views</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/verification-architecture/" class="">
      Is This a Reasonable Architecture?</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/kiro-ide-comparison-tools/" class="">
      Kiro IDE: Comprehensive Analysis, Comparisons &amp; Optimal Workflows</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/langchain-architecture/" class="">
      LangChain: The Foundation Library</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/llm-tracing-metrics-comparison/" class="">
      Llm Tracing Metrics Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/kubernetes-based/" class="">
      Open Source Workflow Orchestration on Kubernetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/tools-overview-and-getting-started/" class="">
      Self-Hosted Open Source Agent Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/serverless-function-workflow-tools-for-kubernetes/" class="">
      Serverless/Function Workflows on Kubernetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/ai-ml/n8n-overview/" class="">
      What Problems Does n8n Solve?</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/" class="">
      Development Platforms</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/backstage-techdocs-pros-cons/" class="">
      Backstage Techdocs Pros Cons</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/cross-diagram-reuse-guide/" class="">
      Cross-Diagram Domain Model Reuse in PlantUML</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/prompt/" class="">
      Crossplane EKS Management Cluster Implementation - Project Brief</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/comprehensive-guide/" class="">
      Driven vs Event: Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/gitops-platform-safety/" class="">
      GitOps Safety Architecture for Platform Evolution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-intro/" class="">
      How Kargo Works with ArgoCD to Manage Deployments</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/backstage-kratix-crossplane-argocd-blueprint/" class="">
      Implementation Blueprint: Crossplane &#43; Kratix &#43; Backstage &#43; ArgoCD</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-git-tags/" class="">
      In subsequent stages, you can read this metadata</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/in-browser-editing-tools/" class="">
      In-Browser Editing Documentation Solutions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/initial-comparison/" class="">
      Initial Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-argocd-interaction/" class="">
      Kargo promotion step</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/presentation/" class="">
      Kargo: GitOps Promotion for ArgoCD</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/notion-overview/" class="">
      Notion: A Comprehensive Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/oss-portal-platform-orchestration-tools/" class="">
      Oss Portal Platform Orchestration Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/oss-vs-closed-portal/" class="">
      Oss Vs Closed Portal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/recommendations/" class="">
      Overview of Text-Based UML Domain Modeling Tools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/export-conversion/" class="">
      PlantUML Export &amp; Embedding Options</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/crossplane-solution/" class="">
      Pseudocode for composition function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/kargo-polyrepo/" class="">
      Response</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/job-configmap-crossplane-abstraction/" class="">
      Shell script helper for Option 3</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/tasks/" class="">
      Stage 1: Approach Overview &amp; Comparison ✅ COMPLETE</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/devplatform/stage3-outline/" class="">
      Stage 3: Implementation Patterns - Outline (Crossplane 2.1)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/" class="">
      Infrastructure</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/runbooks/" class="">
      1. Mental Model Shift (Important Framing)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/argocd-layered-values/" class="">
      ArgoCD and Helm Schema Validation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/prompt-guide/" class="">
      Contents</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/overview/" class="">
      Core Strategy: Progressive Delivery with Blast Radius Containment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/stage1/" class="">
      Crossplane EKS Management Cluster - Approach Overview &amp; Comparison</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/getting-started-concise/" class="">
      Getting Started Concise</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/ci-cd-templates/" class="">
      GitHub Actions Example</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/k8s-mcp-servers/" class="">
      K8s Mcp Servers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/stage2/" class="">
      Management Cluster VPC Layout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/non-helm-schema-validation/" class="">
      Non Helm Schema Validation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/production-readiness-overview/" class="">
      Production Readiness Guide: From Docker Compose to Kubernetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/schema-testing/" class="">
      Quick Start: Generate Schema from Existing values.yaml</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/job-plus-configmap-annotation/" class="">
      Read current state AND capture resourceVersion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/layered-schema/" class="active">
      Schema Validation with Layered Values Files</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/helm-layered-abstraction/" class="">
      Solution 2: Kustomize with Helm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/starting-helm-testing/" class="">
      Understanding What You&#39;re Testing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/executive-summary/" class="">
      What You&#39;re Building</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/infrastructure/devops-domain-model-guide/" class="">
      Why This Approach Works for DevOps</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/workflows/" class="">
      Workflows</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/workflows/imperitive-in-declarative/" class="">
      Imperitive In Declarative</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/mermaid-test/" class="">
      Mermaid Diagram Test</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/misc/" class="">
      Miscellaneous</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/musings/docs/test-document/" class="">
      Test Document</a>
  

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/musings/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Schema Validation with Layered Values Files</h3>

  <label for="toc-control">
    
    <img src="/musings/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#schema-validation-with-layered-values-files">Schema Validation with Layered Values Files</a>
      <ul>
        <li><a href="#the-core-challenge"><strong>The Core Challenge</strong></a></li>
        <li><a href="#how-helm-schema-validation-actually-works"><strong>How Helm Schema Validation Actually Works</strong></a></li>
        <li><a href="#impact-on-what-i-showed-you"><strong>Impact on What I Showed You</strong></a>
          <ul>
            <li><a href="#problem-1-required-fields-break-packaging">Problem 1: Required Fields Break Packaging</a></li>
            <li><a href="#problem-2-cant-validate-individual-layers">Problem 2: Can&rsquo;t Validate Individual Layers</a></li>
            <li><a href="#problem-3-conditional-requirements-based-on-source">Problem 3: Conditional Requirements Based on Source</a></li>
          </ul>
        </li>
        <li><a href="#solution-strategies"><strong>Solution Strategies</strong></a>
          <ul>
            <li><a href="#strategy-1-schema-for-final-state-only-recommended">Strategy 1: Schema for Final State Only (Recommended)</a></li>
            <li><a href="#strategy-2-everything-optional-in-schema-validate-in-templates">Strategy 2: Everything Optional in Schema, Validate in Templates</a></li>
            <li><a href="#strategy-3-hybrid-approach-with-different-validation-contexts">Strategy 3: Hybrid Approach with Different Validation Contexts</a></li>
            <li><a href="#strategy-4-multiple-schema-files-with-manual-testing">Strategy 4: Multiple Schema Files with Manual Testing</a></li>
          </ul>
        </li>
        <li><a href="#testing-with-layered-values"><strong>Testing with Layered Values</strong></a>
          <ul>
            <li><a href="#unit-tests-helm-unittest">Unit Tests (helm-unittest)</a></li>
            <li><a href="#integration-tests-chart-testing">Integration Tests (chart-testing)</a></li>
            <li><a href="#manual-validation">Manual Validation</a></li>
          </ul>
        </li>
        <li><a href="#what-you-can"><strong>What You Can’t Do (JSON Schema Limitations)</strong></a></li>
        <li><a href="#best-practices-for-layered-values"><strong>Best Practices for Layered Values</strong></a>
          <ul>
            <li><a href="#practice-1-document-intent-in-comments">Practice 1: Document Intent in Comments</a></li>
            <li><a href="#practice-2-use-sentinel-values">Practice 2: Use Sentinel Values</a></li>
            <li><a href="#practice-3-validation-hooks">Practice 3: Validation Hooks</a></li>
            <li><a href="#practice-4-separate-required-vs-optional-in-schema-organization">Practice 4: Separate Required vs. Optional in Schema Organization</a></li>
          </ul>
        </li>
        <li><a href="#recommended-approach-for-your-use-case"><strong>Recommended Approach for Your Use Case</strong></a></li>
        <li><a href="#detection-and-warnings"><strong>Detection and Warnings</strong></a>
          <ul>
            <li><a href="#warn-if-required-field-uses-default">Warn if Required Field Uses Default</a></li>
            <li><a href="#fail-fast-on-missing-critical-fields">Fail Fast on Missing Critical Fields</a></li>
          </ul>
        </li>
        <li><a href="#the-uncomfortable-truth"><strong>The Uncomfortable Truth</strong></a></li>
        <li><a href="#questions-to-clarify-your-needs"><strong>Questions to Clarify Your Needs</strong></a></li>
      </ul>
    </li>
    <li><a href="#example-13-schema-pattern-matching-for-sentinel-values">EXAMPLE-13: Schema Pattern Matching for Sentinel Values</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="schema-validation-with-layered-values-files">Schema Validation with Layered Values Files<a class="anchor" href="#schema-validation-with-layered-values-files">#</a></h1>
<p>Great question! This is a <strong>real-world pattern</strong> that many organizations use, and it fundamentally changes how you approach schema validation.</p>
<h2 id="the-core-challenge"><strong>The Core Challenge</strong><a class="anchor" href="#the-core-challenge">#</a></h2>
<p>Your setup is:</p>
<pre tabindex="0"><code>values.yaml (base defaults) 
  + platform.yaml (environment/platform overrides)
  + custom-values.yaml (deployment-specific overrides)
  = final merged values</code></pre><p>The problem: <strong>Helm validates the schema against the MERGED result, not individual files.</strong></p>
<p>This means:</p>
<ul>
<li>If <code>database.password</code> is required but intentionally omitted from <code>values.yaml</code></li>
<li>Your schema validation will PASS when you provide <code>-f values.yaml -f platform.yaml</code></li>
<li>But will FAIL when someone tests with just <code>values.yaml</code> alone</li>
<li>This breaks local development, testing, and chart packaging</li>
</ul>
<h2 id="how-helm-schema-validation-actually-works"><strong>How Helm Schema Validation Actually Works</strong><a class="anchor" href="#how-helm-schema-validation-actually-works">#</a></h2>
<p>When you run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install app . -f values.yaml -f platform.yaml -f custom.yaml</span></span></code></pre></div><p>Helm does this:</p>
<ol>
<li>Merges all value files (left to right, later values override earlier)</li>
<li>Validates the <strong>final merged result</strong> against <code>values.schema.json</code></li>
<li>Then renders templates</li>
</ol>
<p><strong>Key insight:</strong> The schema sees ONE combined values object, not individual layers.</p>
<hr>
<h2 id="impact-on-what-i-showed-you"><strong>Impact on What I Showed You</strong><a class="anchor" href="#impact-on-what-i-showed-you">#</a></h2>
<h3 id="problem-1-required-fields-break-packaging">Problem 1: Required Fields Break Packaging<a class="anchor" href="#problem-1-required-fields-break-packaging">#</a></h3>
<p>If your schema has:
[EXAMPLE-1: Schema marking database.password as required]</p>
<p>Then this fails:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm template . -f values.yaml
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Error: database.password is required</span></span></span></code></pre></div><p>Even though you INTEND to provide it via platform.yaml later. This breaks:</p>
<ul>
<li>Chart Museum publishing (validates with just values.yaml)</li>
<li><code>helm lint</code> (checks values.yaml in isolation)</li>
<li>Developer local testing before they have platform.yaml</li>
</ul>
<h3 id="problem-2-cant-validate-individual-layers">Problem 2: Can&rsquo;t Validate Individual Layers<a class="anchor" href="#problem-2-cant-validate-individual-layers">#</a></h3>
<p>You can&rsquo;t create separate schemas for each layer because:</p>
<ul>
<li>Helm only uses ONE schema file: <code>values.schema.json</code></li>
<li>There&rsquo;s no <code>platform.schema.json</code> or layered validation</li>
<li>You can&rsquo;t tell Helm &ldquo;these fields are required in the final merge but optional in base&rdquo;</li>
</ul>
<h3 id="problem-3-conditional-requirements-based-on-source">Problem 3: Conditional Requirements Based on Source<a class="anchor" href="#problem-3-conditional-requirements-based-on-source">#</a></h3>
<p>What you want: &ldquo;database.password is optional in values.yaml but required in the final deployment&rdquo;</p>
<p>What JSON Schema can express: &ldquo;database.password is required (period)&rdquo; OR &ldquo;database.password is optional (period)&rdquo;</p>
<p>There&rsquo;s no concept of &ldquo;required depending on which file it came from.&rdquo;</p>
<hr>
<h2 id="solution-strategies"><strong>Solution Strategies</strong><a class="anchor" href="#solution-strategies">#</a></h2>
<h3 id="strategy-1-schema-for-final-state-only-recommended">Strategy 1: Schema for Final State Only (Recommended)<a class="anchor" href="#strategy-1-schema-for-final-state-only-recommended">#</a></h3>
<p><strong>Approach:</strong> Schema validates what production MUST have, not what values.yaml contains.</p>
<p>Your <code>values.yaml</code> contains:
[EXAMPLE-2: values.yaml with intentionally empty database section]</p>
<p>Your <code>platform.yaml</code> contains:
[EXAMPLE-3: platform.yaml with actual database credentials]</p>
<p>Your <code>values.schema.json</code> marks <code>database.password</code> as <strong>required</strong>.</p>
<p><strong>Implications:</strong></p>
<ul>
<li>❌ <code>helm template . -f values.yaml</code> fails validation</li>
<li>✅ <code>helm template . -f values.yaml -f platform.yaml</code> passes</li>
<li>✅ Production deployments are validated correctly</li>
<li>❌ Chart packaging/publishing requires workarounds</li>
</ul>
<p><strong>Workaround for packaging:</strong>
[EXAMPLE-4: CI script that provides minimal platform.yaml for validation]</p>
<hr>
<h3 id="strategy-2-everything-optional-in-schema-validate-in-templates">Strategy 2: Everything Optional in Schema, Validate in Templates<a class="anchor" href="#strategy-2-everything-optional-in-schema-validate-in-templates">#</a></h3>
<p><strong>Approach:</strong> Make everything optional in schema, add validation logic in Helm templates.</p>
<p>Your <code>values.schema.json</code>:
[EXAMPLE-5: Schema with all database fields optional]</p>
<p>Your template adds validation:
[EXAMPLE-6: Deployment template with required field checks]</p>
<p><strong>Implications:</strong></p>
<ul>
<li>✅ Chart packages/lints successfully with just values.yaml</li>
<li>✅ Validation happens at render time with merged values</li>
<li>✅ Clear error messages about missing required fields</li>
<li>❌ Less &ldquo;shift-left&rdquo; - errors caught later in process</li>
<li>❌ More verbose templates</li>
</ul>
<hr>
<h3 id="strategy-3-hybrid-approach-with-different-validation-contexts">Strategy 3: Hybrid Approach with Different Validation Contexts<a class="anchor" href="#strategy-3-hybrid-approach-with-different-validation-contexts">#</a></h3>
<p><strong>Approach:</strong> Use schema for structure/types, use templates for requirements.</p>
<p>Schema validates:</p>
<ul>
<li>Data types (string, integer, boolean)</li>
<li>Formats (email, hostname, port ranges)</li>
<li>Enums (allowed values)</li>
<li>Patterns (regex validation)</li>
</ul>
<p>Templates validate:</p>
<ul>
<li>Required fields (since these depend on deployment context)</li>
<li>Cross-field dependencies</li>
<li>Environment-specific rules</li>
</ul>
<p><strong>Implications:</strong></p>
<ul>
<li>✅ Best of both worlds</li>
<li>✅ Schema catches type errors early</li>
<li>✅ Templates catch missing required fields at deploy time</li>
<li>✅ Works with layered values</li>
<li>⚠️ Split validation logic across two places</li>
</ul>
<hr>
<h3 id="strategy-4-multiple-schema-files-with-manual-testing">Strategy 4: Multiple Schema Files with Manual Testing<a class="anchor" href="#strategy-4-multiple-schema-files-with-manual-testing">#</a></h3>
<p><strong>Approach:</strong> Create different schema files for different purposes, manually select which to use.</p>
<p>Files:</p>
<ul>
<li><code>values.schema.json</code> (minimal, for base values.yaml)</li>
<li><code>schemas/production.schema.json</code> (strict, for production)</li>
<li><code>schemas/development.schema.json</code> (relaxed, for dev)</li>
</ul>
<p>You manually test against appropriate schema:
[EXAMPLE-7: Script that validates against different schemas]</p>
<p><strong>Implications:</strong></p>
<ul>
<li>✅ Flexible per-environment validation</li>
<li>❌ Helm only uses <code>values.schema.json</code> automatically</li>
<li>❌ Must remember to run manual validation</li>
<li>❌ More maintenance burden</li>
<li>⚠️ Easy to forget which schema to use when</li>
</ul>
<hr>
<h2 id="testing-with-layered-values"><strong>Testing with Layered Values</strong><a class="anchor" href="#testing-with-layered-values">#</a></h2>
<h3 id="unit-tests-helm-unittest">Unit Tests (helm-unittest)<a class="anchor" href="#unit-tests-helm-unittest">#</a></h3>
<p>Your test files can specify multiple value files:
[EXAMPLE-8: unittest with layered values]</p>
<p><strong>Key point:</strong> Tests see the merged result, just like Helm does.</p>
<h3 id="integration-tests-chart-testing">Integration Tests (chart-testing)<a class="anchor" href="#integration-tests-chart-testing">#</a></h3>
<p>The <code>ct</code> tool follows the same merge behavior:
[EXAMPLE-9: ct test with multiple values files]</p>
<h3 id="manual-validation">Manual Validation<a class="anchor" href="#manual-validation">#</a></h3>
<p>You need to test the full merge:
[EXAMPLE-10: Manual validation commands]</p>
<hr>
<h2 id="what-you-can"><strong>What You Can&rsquo;t Do (JSON Schema Limitations)</strong><a class="anchor" href="#what-you-can">#</a></h2>
<ol>
<li>
<p><strong>Can&rsquo;t mark fields as &ldquo;required in layer N but optional in layer 1&rdquo;</strong></p>
<ul>
<li>JSON Schema has no concept of file provenance</li>
<li>It only sees the final merged object</li>
</ul>
</li>
<li>
<p><strong>Can&rsquo;t validate &ldquo;at least one of these files must provide field X&rdquo;</strong></p>
<ul>
<li>No way to track which file provided which value</li>
<li>Can only validate the final result</li>
</ul>
</li>
<li>
<p><strong>Can&rsquo;t have conditional requirements based on deployment environment</strong></p>
<ul>
<li>Schema is static, doesn&rsquo;t know if you&rsquo;re deploying to dev/staging/prod</li>
<li>Can use conditionals based on VALUES, but not based on CONTEXT</li>
</ul>
</li>
<li>
<p><strong>Can&rsquo;t enforce &ldquo;this field must come from platform.yaml, not values.yaml&rdquo;</strong></p>
<ul>
<li>No file-source tracking</li>
<li>Can&rsquo;t prevent users from putting secrets in wrong file</li>
</ul>
</li>
</ol>
<hr>
<h2 id="best-practices-for-layered-values"><strong>Best Practices for Layered Values</strong><a class="anchor" href="#best-practices-for-layered-values">#</a></h2>
<h3 id="practice-1-document-intent-in-comments">Practice 1: Document Intent in Comments<a class="anchor" href="#practice-1-document-intent-in-comments">#</a></h3>
<p>In your <code>values.yaml</code>:
[EXAMPLE-11: values.yaml with documentation comments]</p>
<h3 id="practice-2-use-sentinel-values">Practice 2: Use Sentinel Values<a class="anchor" href="#practice-2-use-sentinel-values">#</a></h3>
<p>Instead of omitting required fields, use sentinel values:
[EXAMPLE-12: Using sentinel values like REQUIRED or OVERRIDE_ME]</p>
<p>Your schema can then validate:</p>
<p>[EXAMPLE-13: Schema pattern matching for sentinel values]
<strong>this example is at the end of the document with some additional explanation</strong></p>
<p>This gives early feedback: &ldquo;You forgot to override this required field&rdquo;</p>
<h3 id="practice-3-validation-hooks">Practice 3: Validation Hooks<a class="anchor" href="#practice-3-validation-hooks">#</a></h3>
<p>Use Helm hooks to validate before deployment:
[EXAMPLE-14: PreInstall hook that validates required fields]</p>
<h3 id="practice-4-separate-required-vs-optional-in-schema-organization">Practice 4: Separate Required vs. Optional in Schema Organization<a class="anchor" href="#practice-4-separate-required-vs-optional-in-schema-organization">#</a></h3>
<p>Structure your schema to make the layering visible:
[EXAMPLE-15: Schema with comments showing which fields expect platform.yaml]</p>
<hr>
<h2 id="recommended-approach-for-your-use-case"><strong>Recommended Approach for Your Use Case</strong><a class="anchor" href="#recommended-approach-for-your-use-case">#</a></h2>
<p>Based on your layered setup, I recommend:</p>
<p><strong>For values.schema.json:</strong></p>
<ul>
<li>Validate types, formats, enums, patterns</li>
<li>Make &ldquo;will be provided by platform.yaml&rdquo; fields <strong>optional</strong></li>
<li>Use <code>pattern</code> to catch sentinel values if you use them</li>
</ul>
<p><strong>For templates:</strong></p>
<ul>
<li>Add explicit required field checks for production-critical values</li>
<li>Provide helpful error messages referencing which layer should provide the value</li>
</ul>
<p><strong>For CI/CD:</strong></p>
<ul>
<li>Lint/test with merged values (values.yaml + platform.yaml)</li>
<li>Run separate validation for each environment&rsquo;s platform file</li>
</ul>
<p><strong>For documentation:</strong></p>
<ul>
<li>Clearly document which values.yaml fields are &ldquo;placeholders&rdquo;</li>
<li>Document which platform.yaml fields are required</li>
<li>Provide example platform.yaml for each environment</li>
</ul>
<hr>
<h2 id="detection-and-warnings"><strong>Detection and Warnings</strong><a class="anchor" href="#detection-and-warnings">#</a></h2>
<p>You can add warnings for common mistakes:</p>
<h3 id="warn-if-required-field-uses-default">Warn if Required Field Uses Default<a class="anchor" href="#warn-if-required-field-uses-default">#</a></h3>
<p>Template logic to detect if production is using a dev default:
[EXAMPLE-16: Template warning when production uses development defaults]</p>
<h3 id="fail-fast-on-missing-critical-fields">Fail Fast on Missing Critical Fields<a class="anchor" href="#fail-fast-on-missing-critical-fields">#</a></h3>
<p>PreInstall hook that checks critical fields:
[EXAMPLE-17: Hook that validates before any resources are created]</p>
<hr>
<h2 id="the-uncomfortable-truth"><strong>The Uncomfortable Truth</strong><a class="anchor" href="#the-uncomfortable-truth">#</a></h2>
<p>Helm&rsquo;s schema validation wasn&rsquo;t designed for layered values files. It assumes:</p>
<ul>
<li>One canonical <code>values.yaml</code></li>
<li>All required fields present in that file</li>
<li>Overrides are for customization, not completion</li>
</ul>
<p>Your pattern (intentionally incomplete base + required overrides) is valid and common, but fights against Helm&rsquo;s assumptions.</p>
<p><strong>The workaround is accepting that:</strong></p>
<ul>
<li>Schema validates final merged state</li>
<li>You need template-level validation for context-dependent requirements</li>
<li>Your CI/CD must always test with full value layers</li>
<li>Chart packaging requires either minimal platform.yaml or template validation only</li>
</ul>
<hr>
<h2 id="questions-to-clarify-your-needs"><strong>Questions to Clarify Your Needs</strong><a class="anchor" href="#questions-to-clarify-your-needs">#</a></h2>
<p>Before I provide specific examples, tell me:</p>
<ol>
<li>
<p><strong>What&rsquo;s your primary concern?</strong></p>
<ul>
<li>Chart packaging/publishing failing validation?</li>
<li>Developer experience when testing locally?</li>
<li>Catching production deployment errors earlier?</li>
<li>All of the above?</li>
</ul>
</li>
<li>
<p><strong>What fields are intentionally missing from values.yaml?</strong></p>
<ul>
<li>Just secrets (passwords, API keys)?</li>
<li>Environment-specific config (URLs, database hosts)?</li>
<li>Scaling parameters (replicas, resources)?</li>
</ul>
</li>
<li>
<p><strong>How many layers do you have?</strong></p>
<ul>
<li>Just values.yaml + platform.yaml?</li>
<li>Or values.yaml + platform.yaml + environment.yaml + custom.yaml?</li>
</ul>
</li>
<li>
<p><strong>Who controls which layer?</strong></p>
<ul>
<li>Platform team controls platform.yaml?</li>
<li>Developers never see/edit platform.yaml?</li>
<li>Each team has their own overrides?</li>
</ul>
</li>
<li>
<p><strong>What&rsquo;s your deployment pattern?</strong></p>
<ul>
<li>ArgoCD with values files in different repos?</li>
<li>Helm directly with <code>-f</code> flags?</li>
<li>Helmfile managing the layers?</li>
</ul>
</li>
</ol>
<p>Let me know which examples you want to see numbered EXAMPLE-1 through EXAMPLE-17, and I&rsquo;ll provide them based on your specific context.</p>
<h1 id="example-13-schema-pattern-matching-for-sentinel-values">EXAMPLE-13: Schema Pattern Matching for Sentinel Values<a class="anchor" href="#example-13-schema-pattern-matching-for-sentinel-values">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;$schema&#34;</span>: <span style="color:#e6db74">&#34;http://json-schema.org/draft-07/schema#&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;database&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;object&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;host&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;not&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(REQUIRED|OVERRIDE_ME|CHANGEME|TODO)$&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Database hostname - must be overridden in platform.yaml&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;password&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;not&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(REQUIRED|OVERRIDE_ME|CHANGEME|TODO|changeme|password)$&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;minLength&#34;</span>: <span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Database password - must be overridden in platform.yaml&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;port&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;minimum&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;maximum&#34;</span>: <span style="color:#ae81ff">65535</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;not&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;const&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;apiKey&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;not&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(REQUIRED|OVERRIDE_ME|CHANGEME|TODO|your-api-key-here)$&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^[a-zA-Z0-9_-]{32,}$&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;API key for external service - must be real value in platform.yaml&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;externalUrl&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;string&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;uri&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;not&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(REQUIRED|OVERRIDE_ME|https://example\\.com)$&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;External URL - must be overridden for environment&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><strong>How this works:</strong></p>
<ol>
<li>
<p><strong>The <code>not</code> keyword</strong> - JSON Schema validates that the value does NOT match the pattern/const inside the <code>not</code> block</p>
</li>
<li>
<p><strong>Pattern matching</strong> - Catches common sentinel values:</p>
<ul>
<li><code>REQUIRED</code></li>
<li><code>OVERRIDE_ME</code></li>
<li><code>CHANGEME</code></li>
<li><code>TODO</code></li>
<li>Common weak passwords like <code>password</code> or <code>changeme</code></li>
</ul>
</li>
<li>
<p><strong>Validation behavior:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># ❌ This FAILS validation</span>
</span></span><span style="display:flex;"><span>helm install app . <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set database.password<span style="color:#f92672">=</span>REQUIRED
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Error: database.password must not match pattern ^(REQUIRED|OVERRIDE_ME|...)$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ❌ This also FAILS</span>
</span></span><span style="display:flex;"><span>helm install app . <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set database.password<span style="color:#f92672">=</span>changeme
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Error: database.password must not match pattern</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ✅ This PASSES</span>
</span></span><span style="display:flex;"><span>helm install app . <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set database.password<span style="color:#f92672">=</span>actualSecurePassword123</span></span></code></pre></div></li>
<li>
<p><strong>Additional validations combined:</strong></p>
<ul>
<li><code>database.password</code> must NOT be a sentinel value</li>
<li>AND must be at least 8 characters (<code>minLength: 8</code>)</li>
<li>Both conditions must be true</li>
</ul>
</li>
<li>
<p><strong>For URLs:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;not&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;pattern&#34;</span>: <span style="color:#e6db74">&#34;^(REQUIRED|OVERRIDE_ME|https://example\\.com)$&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>This prevents both sentinel values AND the common documentation placeholder <code>https://example.com</code></p>
</li>
</ol>
<p><strong>Corresponding values.yaml would look like:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">database</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host</span>: <span style="color:#ae81ff">OVERRIDE_ME </span> <span style="color:#75715e"># Will fail validation if not overridden</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">REQUIRED</span> <span style="color:#75715e"># Will fail validation if not overridden</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">port</span>: <span style="color:#ae81ff">5432</span>         <span style="color:#75715e"># Valid default, can be used as-is</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiKey</span>: <span style="color:#ae81ff">REQUIRED    </span> <span style="color:#75715e"># Will fail validation if not overridden</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">externalUrl</span>: <span style="color:#ae81ff">https://example.com </span> <span style="color:#75715e"># Will fail validation if not overridden</span></span></span></code></pre></div><p><strong>And platform.yaml provides real values:</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">database</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">host</span>: <span style="color:#ae81ff">prod-db.internal.company.com</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">password</span>: <span style="color:#ae81ff">actualDatabasePassword</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># port inherits 5432 from values.yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiKey</span>: <span style="color:#ae81ff">ak_live_abc123def456ghi789jkl012mno345pqr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">externalUrl</span>: <span style="color:#ae81ff">https://api.production.company.com</span></span></span></code></pre></div><p><strong>Result:</strong></p>
<ul>
<li>Chart packages/lints successfully (sentinel values are valid strings)</li>
<li>Deployment with just values.yaml FAILS validation (sentinel values detected)</li>
<li>Deployment with values.yaml + platform.yaml PASSES (real values provided)</li>
</ul>
<p>This gives you early feedback that required overrides are missing, without making the fields truly &ldquo;required&rdquo; in the schema (which would break packaging).</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/musings/docs/infrastructure/job-plus-configmap-annotation/" class="flex align-center">
        <img src="/musings/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>Read current state AND capture resourceVersion</span>
      </a>
    
    </span>
    <span>
    
      <a href="/musings/docs/infrastructure/helm-layered-abstraction/" class="flex align-center">
        <span>Solution 2: Kustomize with Helm</span>
        <img src="/musings/icons/forward.svg" class="book-icon" alt="Forward" />
      </a>
    
    </span>
  </div>
  


 
        
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#schema-validation-with-layered-values-files">Schema Validation with Layered Values Files</a>
      <ul>
        <li><a href="#the-core-challenge"><strong>The Core Challenge</strong></a></li>
        <li><a href="#how-helm-schema-validation-actually-works"><strong>How Helm Schema Validation Actually Works</strong></a></li>
        <li><a href="#impact-on-what-i-showed-you"><strong>Impact on What I Showed You</strong></a>
          <ul>
            <li><a href="#problem-1-required-fields-break-packaging">Problem 1: Required Fields Break Packaging</a></li>
            <li><a href="#problem-2-cant-validate-individual-layers">Problem 2: Can&rsquo;t Validate Individual Layers</a></li>
            <li><a href="#problem-3-conditional-requirements-based-on-source">Problem 3: Conditional Requirements Based on Source</a></li>
          </ul>
        </li>
        <li><a href="#solution-strategies"><strong>Solution Strategies</strong></a>
          <ul>
            <li><a href="#strategy-1-schema-for-final-state-only-recommended">Strategy 1: Schema for Final State Only (Recommended)</a></li>
            <li><a href="#strategy-2-everything-optional-in-schema-validate-in-templates">Strategy 2: Everything Optional in Schema, Validate in Templates</a></li>
            <li><a href="#strategy-3-hybrid-approach-with-different-validation-contexts">Strategy 3: Hybrid Approach with Different Validation Contexts</a></li>
            <li><a href="#strategy-4-multiple-schema-files-with-manual-testing">Strategy 4: Multiple Schema Files with Manual Testing</a></li>
          </ul>
        </li>
        <li><a href="#testing-with-layered-values"><strong>Testing with Layered Values</strong></a>
          <ul>
            <li><a href="#unit-tests-helm-unittest">Unit Tests (helm-unittest)</a></li>
            <li><a href="#integration-tests-chart-testing">Integration Tests (chart-testing)</a></li>
            <li><a href="#manual-validation">Manual Validation</a></li>
          </ul>
        </li>
        <li><a href="#what-you-can"><strong>What You Can’t Do (JSON Schema Limitations)</strong></a></li>
        <li><a href="#best-practices-for-layered-values"><strong>Best Practices for Layered Values</strong></a>
          <ul>
            <li><a href="#practice-1-document-intent-in-comments">Practice 1: Document Intent in Comments</a></li>
            <li><a href="#practice-2-use-sentinel-values">Practice 2: Use Sentinel Values</a></li>
            <li><a href="#practice-3-validation-hooks">Practice 3: Validation Hooks</a></li>
            <li><a href="#practice-4-separate-required-vs-optional-in-schema-organization">Practice 4: Separate Required vs. Optional in Schema Organization</a></li>
          </ul>
        </li>
        <li><a href="#recommended-approach-for-your-use-case"><strong>Recommended Approach for Your Use Case</strong></a></li>
        <li><a href="#detection-and-warnings"><strong>Detection and Warnings</strong></a>
          <ul>
            <li><a href="#warn-if-required-field-uses-default">Warn if Required Field Uses Default</a></li>
            <li><a href="#fail-fast-on-missing-critical-fields">Fail Fast on Missing Critical Fields</a></li>
          </ul>
        </li>
        <li><a href="#the-uncomfortable-truth"><strong>The Uncomfortable Truth</strong></a></li>
        <li><a href="#questions-to-clarify-your-needs"><strong>Questions to Clarify Your Needs</strong></a></li>
      </ul>
    </li>
    <li><a href="#example-13-schema-pattern-matching-for-sentinel-values">EXAMPLE-13: Schema Pattern Matching for Sentinel Values</a></li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















